<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>安之</title>
  
  <subtitle>临渊羡鱼不如退而结网</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-05-26T01:22:20.726Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>MiK</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>层级排序</title>
    <link href="http://example.com/2023/05/26/%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/%E5%B1%82%E7%BA%A7%E6%8E%92%E5%BA%8F/"/>
    <id>http://example.com/2023/05/26/%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98/%E5%B1%82%E7%BA%A7%E6%8E%92%E5%BA%8F/</id>
    <published>2023-05-26T01:17:19.026Z</published>
    <updated>2023-05-26T01:22:20.726Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-问题"><a href="#1-问题" class="headerlink" title="1. 问题"></a>1. 问题</h1><blockquote><p>  将一组字符串 [“x”,”x.x”,”x.x.x”,”x.x.x.x”,”x.x.x…”] 按照层级排序,其中 x 包含 x.x, x.x 包含 x.x.x …. </p><p>  例如 1 包含 1.1、1.2、1.3，而 1.1 中包含 1.1.1、1.1.2、1.1.3 … </p></blockquote><h1 id="2-解决"><a href="#2-解决" class="headerlink" title="2. 解决"></a>2. 解决</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wlm.code;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; tree = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;3.1&quot;</span>, <span class="string">&quot;3.1.2&quot;</span>, <span class="string">&quot;3.1.1&quot;</span>, <span class="string">&quot;3.2&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;4.1&quot;</span>));</span><br><span class="line">        List&lt;String&gt; sortedTree = sortTree(<span class="literal">null</span>,tree);</span><br><span class="line">        System.out.println(sortedTree);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">sortTree</span><span class="params">(String parent,List&lt;String&gt; tree)</span> &#123;</span><br><span class="line">        <span class="comment">// 将传过来的树按照第一层进行排序</span></span><br><span class="line">        tree.sort(Comparator.comparing(Demo::getFirstLevel));</span><br><span class="line">        <span class="comment">// 创建子树存储子节点</span></span><br><span class="line">        List&lt;String&gt; sortedTree = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 遍历取出所有节点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tree.size(); i++) &#123;</span><br><span class="line">            <span class="comment">// 获取当前节点</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">node</span> <span class="operator">=</span> tree.get(i);</span><br><span class="line">            <span class="comment">// 如果当前节点包含&quot;.&quot;，则表示当前节点有子节点</span></span><br><span class="line">            <span class="keyword">if</span> (node.contains(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// 创建子树存储子节点</span></span><br><span class="line">                List&lt;String&gt; subTree = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="comment">// 获取当前节点的第一个节点</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">firstNode</span> <span class="operator">=</span> node.split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">// 获取当前节点的子节点</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; tree.size(); j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!tree.get(j).startsWith(firstNode + <span class="string">&quot;.&quot;</span>)) <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">// 去除子节点的第一个节点</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">subNode</span> <span class="operator">=</span> tree.get(j).replaceFirst(firstNode + <span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                    <span class="comment">// 将去除后的子节点存入子树中</span></span><br><span class="line">                    subTree.add(subNode);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 更改父节点信息</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    sortedTree.add(sortTree(parent + <span class="string">&quot;.&quot;</span> + firstNode,subTree).toString());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    sortedTree.add(sortTree(firstNode,subTree).toString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 跳过子节点</span></span><br><span class="line">                i += subTree.size() - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 否则表示当前节点没有子节点</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 存入结果集中(如果有父节点，则将父节点和当前节点拼接)</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    sortedTree.add(parent + <span class="string">&quot;.&quot;</span> + node);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    sortedTree.add(node);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回结果集</span></span><br><span class="line">        <span class="keyword">return</span> sortedTree;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取第一层的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title function_">getFirstLevel</span><span class="params">(String node)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(node.split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">记录一次特殊的排序</summary>
    
    
    
    <category term="日常学习" scheme="http://example.com/categories/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="日常学习" scheme="http://example.com/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://example.com/2022/12/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
    <id>http://example.com/2022/12/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2.%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/</id>
    <published>2022-12-15T09:33:17.044Z</published>
    <updated>2022-12-15T09:52:46.595Z</updated>
    
    <content type="html"><![CDATA[<h1 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h1><h2 id="1-进程与线程"><a href="#1-进程与线程" class="headerlink" title="1. 进程与线程"></a>1. 进程与线程</h2><h3 id="1-1-进程的定义、特征、组成、组织"><a href="#1-1-进程的定义、特征、组成、组织" class="headerlink" title="1.1 进程的定义、特征、组成、组织"></a>1.1 进程的定义、特征、组成、组织</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215173522483.png" alt="image-20221215173522483"></p><h4 id="1-1-1-进程的定义"><a href="#1-1-1-进程的定义" class="headerlink" title="1.1.1 进程的定义"></a>1.1.1 进程的定义</h4><p>程序：就是一个指令序列</p><p>早期的计算机只支持单道程序：</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215173751997.png" alt="image-20221215173751997"></p><p>引入<strong>多道</strong>程序技术之后：</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174009680.png" alt="image-20221215174009680"></p><p><strong>程序段、数据段、PCB</strong>三部分组成了<strong>进程实体（进程映像）</strong>。一般情况下，我们把进程实体就简称为进程，例如，所谓创建进程，实质上是创建进程实体中的PCB:而撤销进程，实质上是撤销进程实体中的PCB。</p><p><strong>注意：PCB是进程存在的唯一标志！</strong></p><p>从不同的角度，进程可以有不同的定义，比较传统典型的定义有：</p><ol><li>进程是程序的一次<strong>执行过程</strong>。</li><li>进程是一个程序及其数据在处理机上顺序执行时所<strong>发生的活动</strong>。</li><li>进程是具有独立功能的程序在数据集合上<strong>运行的过程</strong>，它是系统进行资源分配和调度的一个独立单位</li></ol><p>引入进程实体的概念后，可把进程定义为：<br>进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位。</p><p>注：严格来说，进程实体和进程并不一样，进程实体是静态的，进程则是动态的。不过，除非题目专门考察二者区别，否则可以认为进程实体就是进程。因此我们也可以说“进程由程序段、数据段、PCB三部分组成”</p><h4 id="1-1-2-进程的组成"><a href="#1-1-2-进程的组成" class="headerlink" title="1.1.2 进程的组成"></a>1.1.2 进程的组成</h4><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174316628.png" alt="image-20221215174316628"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174632115.png" alt="image-20221215174632115"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174657599.png" alt="image-20221215174657599"></p><h4 id="1-1-3-进程的组织"><a href="#1-1-3-进程的组织" class="headerlink" title="1.1.3 进程的组织"></a>1.1.3 进程的组织</h4><p>在一个系统中，通常有数十、数百乃至数千个PCB。为了能对他们加以有效的管理，应该用适当的方式把这些PCB组织起来。<br>注：进程的组成讨论的是一个进程内部由哪些部分构成的问题，而进程的组织讨论的是多个进程之间的组织方式问题</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174837323.png" alt="image-20221215174837323"></p><p><strong>链接方式</strong></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215174957721.png" alt="image-20221215174957721"></p><p><strong>索引方式</strong></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215175144793.png" alt="image-20221215175144793"></p><h4 id="1-1-4-进程的特征"><a href="#1-1-4-进程的特征" class="headerlink" title="1.1.4 进程的特征"></a>1.1.4 进程的特征</h4><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215175240600.png" alt="image-20221215175240600"></p><h2 id="2-处理机的调度"><a href="#2-处理机的调度" class="headerlink" title="2. 处理机的调度"></a>2. 处理机的调度</h2><h2 id="3-进程的同步与互斥"><a href="#3-进程的同步与互斥" class="headerlink" title="3. 进程的同步与互斥"></a>3. 进程的同步与互斥</h2><h2 id="4-死锁"><a href="#4-死锁" class="headerlink" title="4. 死锁"></a>4. 死锁</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;进程管理&quot;&gt;&lt;a href=&quot;#进程管理&quot; class=&quot;headerlink&quot; title=&quot;进程管理&quot;&gt;&lt;/a&gt;进程管理&lt;/h1&gt;&lt;h2 id=&quot;1-进程与线程&quot;&gt;&lt;a href=&quot;#1-进程与线程&quot; class=&quot;headerlink&quot; title=&quot;1. </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title></title>
    <link href="http://example.com/2022/12/07/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
    <id>http://example.com/2022/12/07/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</id>
    <published>2022-12-07T09:08:28.605Z</published>
    <updated>2022-12-15T09:33:21.945Z</updated>
    
    <content type="html"><![CDATA[<h1 id="操作系统的基本概念"><a href="#操作系统的基本概念" class="headerlink" title="操作系统的基本概念"></a>操作系统的基本概念</h1><h2 id="1-概念功能和目标"><a href="#1-概念功能和目标" class="headerlink" title="1. 概念功能和目标"></a>1. 概念功能和目标</h2><h3 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h3><p>电脑的组成：裸机+操作系统+软件</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221207171529871.png" alt="image-20221207171529871"></p><p><strong>操作系统(Operating System,OS)</strong> 是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的<strong>系统软件</strong>。</p><h3 id="1-2-功能和目标"><a href="#1-2-功能和目标" class="headerlink" title="1.2 功能和目标"></a>1.2 功能和目标</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221207172242055.png" alt="image-20221207172242055"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221207172424626.png" alt="image-20221207172424626"></p><p>用户接口：</p><ol><li><p>命令接口（允许用户直接使用）</p><ol><li><p>联机命令接口：用户说一句，系统做一句</p><p>相当于在windows打开cmd 输入一句执行一句</p></li><li><p>脱机命令接口：用户说一堆，系统做一堆</p><p>相当于将需要的一堆命令作为dat批处理文件，直接运行</p></li></ol></li><li><p>程序接口（允许用户通过程序间接使用）由一组系统调用组成（程序接口&#x3D;系统调用）</p></li></ol><p><strong>系统调用 &#x3D; 广义指令</strong></p><p>GUI:图形用户界面，用户可以使用形象的图形界面进行操作</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221207173209001.png" alt="image-20221207173209001"></p><p>操作系统作为最接近硬件的层次，需要提供的功能和目标是<strong>实现对硬件机器的拓展</strong>，没有任何软件支持的计算机成为<strong>裸机</strong>。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器，</p><p>通常把覆盖了软件的机器成为扩充机器，又称之为<strong>虚拟机</strong></p><h2 id="2-操作系统的特征"><a href="#2-操作系统的特征" class="headerlink" title="2. 操作系统的特征"></a>2. 操作系统的特征</h2><h3 id="2-1-并发"><a href="#2-1-并发" class="headerlink" title="2.1 并发"></a>2.1 并发</h3><p><strong>并发</strong>：指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的操作系统的并发性指计算机系统中同时存在着多个运行着的程序。</p><p>一个单核处理机(CPU)同一时刻只能执行一个程序，因此操作系统会负责协调多个程序交替执行（这些程序微观上是交替执行的，但宏观上看起来就像在同时执行)，事实上，操作系统就是伴随着“多道程序技术”而出现的，因此，操作系统和程序并发是一起诞生的。</p><p>当今的计算机，一般都是多核CPU,比如Intel的第八代i3处理器就是4核CPU,这意味着同一时刻可以有4个程序并行执行，但是操作系统对的并发性依然必不可少，当代人使用计算机绝对有4个以上的程序需要同时工作。</p><h3 id="2-2-共享"><a href="#2-2-共享" class="headerlink" title="2.2 共享"></a>2.2 共享</h3><p><strong>共享</strong>即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。</p><p><img src="C:\Users\wlm\AppData\Roaming\Typora\typora-user-images\image-20221213195604505.png" alt="image-20221213195604505"></p><p>所谓的“同时”往往是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问的（即分时共享）</p><p><strong>两者之间的关系（并发和共享）</strong></p><p>并发性指计算机系统中同时存在着多个运行着的程序。<br>共享性是指系统中的资源可供内存中多个并发执行的进程共同使用。</p><h3 id="2-3-虚拟"><a href="#2-3-虚拟" class="headerlink" title="2.3 虚拟"></a>2.3 虚拟</h3><p><strong>虚拟</strong>是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者)是用户感受到的。</p><p><strong>背景知识</strong>：一个程序需要放入内存并给它分配CPU才能执行</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213202516856.png" alt="image-20221213202516856"></p><h3 id="2-4-异步"><a href="#2-4-异步" class="headerlink" title="2.4 异步"></a>2.4 异步</h3><p>异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。</p><p>如果失去了并发性，则系统只能串行地处理各个进程，每个进程的执会一贯到底。只有系统拥有并发性，才有可能导致异步性。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213203058447.png" alt="image-20221213203058447"></p><h2 id="3-操作系统的发展与分类"><a href="#3-操作系统的发展与分类" class="headerlink" title="3. 操作系统的发展与分类"></a>3. 操作系统的发展与分类</h2><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213203228666.png" alt="image-20221213203228666"></p><h3 id="3-1-手工操作阶段"><a href="#3-1-手工操作阶段" class="headerlink" title="3.1 手工操作阶段"></a>3.1 手工操作阶段</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213204155301.png" alt="image-20221213204155301"></p><h3 id="3-2-单道批处理系统"><a href="#3-2-单道批处理系统" class="headerlink" title="3.2 单道批处理系统"></a>3.2 单道批处理系统</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213204415300.png" alt="image-20221213204415300"></p><h3 id="3-3-多道批处理系统"><a href="#3-3-多道批处理系统" class="headerlink" title="3.3 多道批处理系统"></a>3.3 多道批处理系统</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213204709565.png" alt="image-20221213204709565"></p><h3 id="3-4-分时操作系统"><a href="#3-4-分时操作系统" class="headerlink" title="3.4 分时操作系统"></a>3.4 分时操作系统</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213205817174.png" alt="image-20221213205817174"></p><h3 id="3-5-实时操作系统"><a href="#3-5-实时操作系统" class="headerlink" title="3.5 实时操作系统"></a>3.5 实时操作系统</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213210007566.png" alt="image-20221213210007566"></p><h2 id="4-操作系统的运行机制和体系结构"><a href="#4-操作系统的运行机制和体系结构" class="headerlink" title="4. 操作系统的运行机制和体系结构"></a>4. 操作系统的运行机制和体系结构</h2><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213210412793.png" alt="image-20221213210412793"></p><h3 id="4-0-什么是指令"><a href="#4-0-什么是指令" class="headerlink" title="4.0 什么是指令"></a>4.0 什么是指令</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213210825025.png" alt="image-20221213210825025"></p><p><strong>新的问题：</strong><br>有的指令“人畜无害”。比如：加、减、乘、除这些普通的运算指令。<br>有的指令有很高的权限。比如：内存清零指令。如果用户程序可以使用这个指令，就意味着一个用户可以将其他用户的内存数据随意清零，这样做显然是很危险的。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213210927009.png" alt="image-20221213210927009"></p><p><strong>CPU如何判断当前是否可以执行特权指令?</strong></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213211037493.png" alt="image-20221213211037493"></p><p><img src="C:\Users\wlm\AppData\Roaming\Typora\typora-user-images\image-20221213211150288.png" alt="image-20221213211150288"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213211215164.png" alt="image-20221213211215164"></p><h3 id="4-1-操作系统内核"><a href="#4-1-操作系统内核" class="headerlink" title="4.1 操作系统内核"></a>4.1 操作系统内核</h3><p>Yo~生活经验：我们安装完Windows操作系统后，会发现操作系统提供了多种多样的功能，比如“记事本”、“任务管理器”。然而，这些功能并不是必不可少的。即使没有“任务管理器”，我们仍然可以使用计算机。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213211728398.png" alt="image-20221213211728398"></p><p><strong>内核</strong>是计算机上配置的<strong>底层</strong>软件，是操作系统最基本、最核心的部分。</p><p>实现操作系统内核功能的那些程序就是<strong>内核程序</strong>。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213212001181.png" alt="image-20221213212001181"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213212443827.png" alt="image-20221213212443827"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221213213109236.png" alt="image-20221213213109236"></p><h2 id="5-中断和异常"><a href="#5-中断和异常" class="headerlink" title="5. 中断和异常"></a>5. 中断和异常</h2><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215162153137.png" alt="image-20221215162153137"></p><h3 id="5-1-中断机制的诞生"><a href="#5-1-中断机制的诞生" class="headerlink" title="5.1 中断机制的诞生"></a>5.1 中断机制的诞生</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215162345334.png" alt="image-20221215162345334"></p><p><strong>本质</strong>：发生中断就意味着需要操作系统介入，开展管理工作</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215162433115.png" alt="image-20221215162433115"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215162832556.png" alt="image-20221215162832556"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163423002.png" alt="image-20221215163423002"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163506269.png" alt="image-20221215163506269"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163553950.png" alt="image-20221215163553950"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163607352.png" alt="image-20221215163607352"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163617579.png" alt="image-20221215163617579"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215163634384.png" alt="image-20221215163634384"></p><h3 id="5-2-中断的概念和作用"><a href="#5-2-中断的概念和作用" class="headerlink" title="5.2 中断的概念和作用"></a>5.2 中断的概念和作用</h3><ol><li>当中断发生时，CPU立即进入<strong>核心态</strong></li><li>当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理</li><li>对于不同的中断信号，会进行不同的处理</li></ol><p>发生了中断，就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配&#x2F;O设备等)需要使用特权指令，因此CPU要从用户态转为核心态。<strong>中断</strong>可以使CPU从<strong>用户态切换为核心态，使操作系统获得计算机的控制权</strong>。有了中断，才能实现多道程序并发执行。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215164141031.png" alt="image-20221215164141031"></p><h3 id="5-3-中断的分类"><a href="#5-3-中断的分类" class="headerlink" title="5.3 中断的分类"></a>5.3 中断的分类</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215164505144.png" alt="image-20221215164505144"></p><p>另一类的中断分类方式：</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215164604171.png" alt="image-20221215164604171"></p><h3 id="5-4-外中断的处理过程"><a href="#5-4-外中断的处理过程" class="headerlink" title="5.4 外中断的处理过程"></a>5.4 外中断的处理过程</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215164853481.png" alt="image-20221215164853481"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215164907552.png" alt="image-20221215164907552"></p><h2 id="6-系统调用"><a href="#6-系统调用" class="headerlink" title="6. 系统调用"></a>6. 系统调用</h2><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215165250145.png" alt="image-20221215165250145"></p><p>“系统调用”是操作系统提供给应用程序（程序员&#x2F;编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，应用程序可以发出系统调用请求来获得操作系统的服务。</p><h3 id="6-1-什么是系统调用，有何作用？"><a href="#6-1-什么是系统调用，有何作用？" class="headerlink" title="6.1 什么是系统调用，有何作用？"></a>6.1 什么是系统调用，有何作用？</h3><p>应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作（如存储分配、&#x2F;O操作、文件管理等），都必须通过系统调用的方式向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。</p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215170326660.png" alt="image-20221215170326660"></p><h3 id="6-2-系统调用和库函数的区别"><a href="#6-2-系统调用和库函数的区别" class="headerlink" title="6.2 系统调用和库函数的区别"></a>6.2 系统调用和库函数的区别</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215170559570.png" alt="image-20221215170559570"></p><p>不涉及系统调用的库函数：如“取绝对值”的函数</p><p>涉及系统调用的库函数：如“创建一个新文件”的函数</p><h3 id="6-3-系统调用背后的过程"><a href="#6-3-系统调用背后的过程" class="headerlink" title="6.3 系统调用背后的过程"></a>6.3 系统调用背后的过程</h3><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215171846820.png" alt="image-20221215171846820"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215172245938.png" alt="image-20221215172245938"></p><p><img src="https://raw.githubusercontent.com/Minkes/BlogImage/master/image-20221215172619460.png" alt="image-20221215172619460"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;操作系统的基本概念&quot;&gt;&lt;a href=&quot;#操作系统的基本概念&quot; class=&quot;headerlink&quot; title=&quot;操作系统的基本概念&quot;&gt;&lt;/a&gt;操作系统的基本概念&lt;/h1&gt;&lt;h2 id=&quot;1-概念功能和目标&quot;&gt;&lt;a href=&quot;#1-概念功能和目标&quot; class</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>18.函数-存储过程-触发器</title>
    <link href="http://example.com/2022/12/05/SqlServer/18.%E5%87%BD%E6%95%B0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-%E8%A7%A6%E5%8F%91%E5%99%A8/"/>
    <id>http://example.com/2022/12/05/SqlServer/18.%E5%87%BD%E6%95%B0-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-%E8%A7%A6%E5%8F%91%E5%99%A8/</id>
    <published>2022-12-05T03:00:13.334Z</published>
    <updated>2022-12-05T09:34:03.848Z</updated>
    
    <content type="html"><![CDATA[<h1 id="函数-存储过程-触发器"><a href="#函数-存储过程-触发器" class="headerlink" title="函数-存储过程-触发器"></a>函数-存储过程-触发器</h1><h2 id="1-函数"><a href="#1-函数" class="headerlink" title="1. 函数"></a>1. 函数</h2><blockquote><p>  函数分为(1)系统函数，(2)自定义函数。</p></blockquote><p>其中自定义函数又可以分为</p><ol><li>标量值函数（返回单个值）</li><li>表值函数（返回查询结果）</li></ol><p>本文主要个绍自定义函数的使用。</p><ol><li>编写一个函数求该银行的金额总和</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetSumCardMoney ()</span><br><span class="line"><span class="keyword">returns</span> money</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@AllMoney</span> money;</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@AllMoney</span><span class="operator">=</span>  (<span class="keyword">select</span> <span class="built_in">sum</span>(CardMoney)<span class="keyword">from</span> BankCard );</span><br><span class="line"><span class="keyword">return</span> <span class="variable">@AllMoney</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>函数调用</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 函数调用</span></span><br><span class="line"><span class="keyword">select</span> dbo.GetSumCardMoney()</span><br></pre></td></tr></table></figure><ol start="3"><li>函数删除</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 函数删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> GetSumCardMoney</span><br></pre></td></tr></table></figure><ol start="4"><li>传参之后返回值</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetRealNameById(<span class="variable">@accid</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@name</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@name</span> <span class="operator">=</span> ( <span class="keyword">select</span> RealName <span class="keyword">from</span> AccountInfo <span class="keyword">where</span> AccountId <span class="operator">=</span> <span class="variable">@accid</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="variable">@name</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="5"><li>返回多个查询结果</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 传递开始时间和结束时间，返回交易记录(存钱取钱)</span></span><br><span class="line"><span class="comment">-- 方案一(函数体内可以加入复杂逻辑)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetRecordByTime (<span class="variable">@start</span> <span class="type">varchar</span>(<span class="number">30</span>), <span class="variable">@end</span> <span class="type">varchar</span>(<span class="number">30</span>))</span><br><span class="line"><span class="keyword">returns</span> <span class="variable">@result</span> <span class="keyword">table</span> (RealName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--真实姓名</span></span><br><span class="line">   CardNo <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡号（与银行卡表形成主外键关系）</span></span><br><span class="line">   MoneyInBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--存钱金额</span></span><br><span class="line">   MoneyOutBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--取钱金额</span></span><br><span class="line">   ExchangeTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--交易时间</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- 进行其他的编写</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="variable">@result</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">RealName 姓名, CardExchange.CardNo 卡号, MoneyInBank 存钱金额, MoneyOutBank 取钱金额, ExchangeTime 交易时间</span><br><span class="line"><span class="keyword">from</span>CardExchange</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> BankCard <span class="keyword">on</span> CardExchange.CardNo<span class="operator">=</span>BankCard.CardNo</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> AccountInfo <span class="keyword">on</span> BankCard.AccountId<span class="operator">=</span>AccountInfo.AccountId</span><br><span class="line"><span class="keyword">where</span>ExchangeTime <span class="keyword">between</span> <span class="variable">@start</span><span class="operator">+</span><span class="string">&#x27; 00:00:00&#x27;</span> <span class="keyword">and</span> <span class="variable">@end</span><span class="operator">+</span><span class="string">&#x27; 23:59:59&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- 方案二(函数体内只能有return + sql查询结果)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetRecordByTime (<span class="variable">@start</span> <span class="type">varchar</span>(<span class="number">30</span>), <span class="variable">@end</span> <span class="type">varchar</span>(<span class="number">30</span>))</span><br><span class="line"><span class="keyword">returns</span> <span class="variable">@result</span> <span class="keyword">table</span> (RealName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--真实姓名</span></span><br><span class="line">   CardNo <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡号（与银行卡表形成主外键关系）</span></span><br><span class="line">   MoneyInBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--存钱金额</span></span><br><span class="line">   MoneyOutBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--取钱金额</span></span><br><span class="line">   ExchangeTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--交易时间</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">RealName 姓名, CardExchange.CardNo 卡号, MoneyInBank 存钱金额, MoneyOutBank 取钱金额, ExchangeTime 交易时间</span><br><span class="line"><span class="keyword">from</span>CardExchange</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> BankCard <span class="keyword">on</span> CardExchange.CardNo<span class="operator">=</span>BankCard.CardNo</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> AccountInfo <span class="keyword">on</span> BankCard.AccountId<span class="operator">=</span>AccountInfo.AccountId</span><br><span class="line"><span class="keyword">where</span>ExchangeTime <span class="keyword">between</span> <span class="variable">@start</span><span class="operator">+</span><span class="string">&#x27; 00:00:00&#x27;</span> <span class="keyword">and</span> <span class="variable">@end</span><span class="operator">+</span><span class="string">&#x27; 23:59:59&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p><strong>练习</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询银行卡信息，将银行卡状态1，2，3，4分别转换为汉字 ”正常，挂失，冻结，注销“，</span></span><br><span class="line"><span class="comment">-- 并且根据银行卡余额显示银行卡等级</span></span><br><span class="line"><span class="comment">-- 30万以下为普通用户，30万以上为vip用户</span></span><br><span class="line"><span class="comment">-- 显示列分别为卡号、身份证、姓名、余额、用户等级、银行卡状态</span></span><br><span class="line"><span class="keyword">select</span> CardNo 卡号,AccountCode 身份证号,RealName 姓名, CardMoney 余额,</span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> CardMoney <span class="operator">&gt;=</span> <span class="number">300000</span> <span class="keyword">then</span> <span class="string">&#x27;VIP用户&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;普通用户&#x27;</span></span><br><span class="line"><span class="keyword">end</span> 用户等级,</span><br><span class="line"><span class="keyword">case</span> CardState</span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;正常&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;挂失&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;冻结&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;注销&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;异常&#x27;</span></span><br><span class="line"><span class="keyword">end</span> 银行卡状态</span><br><span class="line"><span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId <span class="operator">=</span> BankCard.AccountId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求银行卡等级函数</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetGrade(<span class="variable">@cardMoney</span> money)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@result</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line">if <span class="variable">@cardMoney</span> <span class="operator">&gt;=</span> <span class="number">300000</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;VIP用户&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;普通用户&#x27;</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">@result</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求银行卡状态函数</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetState(<span class="variable">@state</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@result</span> <span class="type">varchar</span>(<span class="number">30</span>)</span><br><span class="line">if <span class="variable">@state</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;正常&#x27;</span></span><br><span class="line"><span class="keyword">else</span> if <span class="variable">@state</span> <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;挂失&#x27;</span></span><br><span class="line"><span class="keyword">else</span> if <span class="variable">@state</span> <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;冻结&#x27;</span></span><br><span class="line"><span class="keyword">else</span> if <span class="variable">@state</span> <span class="operator">=</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;注销&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@result</span> <span class="operator">=</span> <span class="string">&#x27;异常&#x27;</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">@result</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询银行卡信息，将银行卡状态1，2，3，4分别转换为汉字 ”正常，挂失，冻结，注销“，</span></span><br><span class="line"><span class="comment">-- 并且根据银行卡余额显示银行卡等级</span></span><br><span class="line"><span class="comment">-- 30万以下为普通用户，30万以上为vip用户</span></span><br><span class="line"><span class="comment">-- 显示列分别为卡号、身份证、姓名、余额、用户等级、银行卡状态</span></span><br><span class="line"><span class="keyword">select</span> CardNo 卡号,AccountCode 身份证号,RealName 姓名, CardMoney 余额,</span><br><span class="line">dbo.GetGrade(CardMoney) 用户等级, dbo.GetState(CardState) 银行卡状态</span><br><span class="line"><span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId <span class="operator">=</span> BankCard.AccountId</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Emp</span><br><span class="line">(</span><br><span class="line">EmpId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">empName <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">empSex <span class="type">varchar</span>(<span class="number">4</span>),</span><br><span class="line">empBirth smalldatetime</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;刘备&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;2008-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;张飞&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;1998-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;关羽&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;1999-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;赵云&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;2003-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;马超&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;1998-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Emp (empName, empSex, empBirth)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;黄忠&#x27;</span>,<span class="comment">-- empName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- empSex - varchar(4)</span></span><br><span class="line"><span class="string">&#x27;1988-5-8&#x27;</span><span class="comment">-- empBirth - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 编写函数，根据出生日期求年龄，年龄求实岁，例如</span></span><br><span class="line"><span class="comment">--生日为2000-5-5，当前为2018-5-4，年龄为17岁</span></span><br><span class="line"><span class="comment">--生日为2000-5-5，当前为2018-5-6，年龄为18岁</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,<span class="keyword">year</span>(getdate() <span class="operator">-</span> <span class="keyword">year</span>(empBirth)) <span class="keyword">from</span> Emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> GetAge(<span class="variable">@birth</span> smalldatetime)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">int</span> </span><br><span class="line"><span class="keyword">as</span> <span class="keyword">begin</span> </span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@age</span> <span class="type">int</span> </span><br><span class="line"><span class="keyword">set</span> <span class="variable">@age</span> <span class="operator">=</span> <span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(<span class="variable">@birth</span>)</span><br><span class="line">if <span class="keyword">month</span>(getdate()) <span class="operator">&lt;</span> <span class="keyword">month</span>(<span class="variable">@birth</span>)</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@age</span> <span class="operator">=</span> <span class="variable">@age</span> <span class="operator">-</span> <span class="number">1</span></span><br><span class="line">if <span class="keyword">month</span>(getdate()) <span class="operator">=</span> <span class="keyword">month</span>(<span class="variable">@birth</span>) <span class="keyword">and</span> <span class="keyword">day</span>(getdate()) <span class="operator">&lt;</span> <span class="keyword">day</span>(<span class="variable">@birth</span>)</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@age</span> <span class="operator">=</span> <span class="variable">@age</span> <span class="number">-1</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">@age</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> GetAge;</span><br><span class="line"><span class="keyword">update</span> dbo.Emp <span class="keyword">set</span> empBirth <span class="operator">=</span> <span class="string">&#x27;2008-12-06&#x27;</span> <span class="keyword">where</span> EmpId <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(empBirth) 年龄 <span class="keyword">from</span> dbo.Emp</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,dbo.GetAge(Emp.empBirth) 年龄 <span class="keyword">from</span> Emp</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-触发器"><a href="#2-触发器" class="headerlink" title="2. 触发器"></a>2. 触发器</h2><blockquote><p>  触发器分类：</p><ol><li>“Instead of”触发器 : 在执行操作之前被执行</li><li>“After’”触发器:在执行操作之后被执行</li></ol></blockquote><p>触发器中后面的案例中需要用到的表及测试数据如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Department</span><br><span class="line">(</span><br><span class="line">DepartmentId <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">primary</span> key,</span><br><span class="line">DepartmentName nvarchar(<span class="number">50</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> People</span><br><span class="line">(</span><br><span class="line">PeopleId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">DepartmentId <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">PeopleName nvarchar(<span class="number">20</span>),</span><br><span class="line">PeopleSex nvarchar(<span class="number">2</span>),</span><br><span class="line">PeoplePhone nvarchar(<span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;总经办&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;002&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;市场部&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;003&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;人事部&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;004&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;财务部&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;005&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;软件部&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.People (DepartmentId, PeopleName, PeopleSex, PeoplePhone)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;刘备&#x27;</span>,<span class="comment">-- PeopleName - nvarchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- PeopleSex - nvarchar(2)</span></span><br><span class="line"><span class="string">&#x27;135558785478&#x27;</span><span class="comment">-- PeoplePhone - nvarchar(20)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.People (DepartmentId, PeopleName, PeopleSex, PeoplePhone)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>,<span class="comment">-- PeopleName - nvarchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- PeopleSex - nvarchar(2)</span></span><br><span class="line"><span class="string">&#x27;135558788785&#x27;</span><span class="comment">-- PeoplePhone - nvarchar(20)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.People (DepartmentId, PeopleName, PeopleSex, PeoplePhone)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;002&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;张飞&#x27;</span>,<span class="comment">-- PeopleName - nvarchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- PeopleSex - nvarchar(2)</span></span><br><span class="line"><span class="string">&#x27;13698547125&#x27;</span><span class="comment">-- PeoplePhone - nvarchar(20)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.People</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>触发器练习：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假设有部门表和员工表，在添加员工的时候，该员工的部门编号如果在部门表中找不到，则自动添加部门信息，部门名称为&#x27;新部门&#x27;</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_InsertPoeple <span class="keyword">on</span> People after <span class="keyword">insert</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">if <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Department <span class="keyword">where</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> inserted))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Department (DepartmentId, DepartmentName)</span><br><span class="line"><span class="keyword">values</span> ((<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> inserted),<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;新部门&#x27;</span><span class="comment">-- DepartmentName - nvarchar(50)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.People (DepartmentId, PeopleName, PeopleSex, PeoplePhone)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;003&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;赵云&#x27;</span>,<span class="comment">-- PeopleName - nvarchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- PeopleSex - nvarchar(2)</span></span><br><span class="line"><span class="string">&#x27;13698547125&#x27;</span><span class="comment">-- PeoplePhone - nvarchar(20)</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.People (DepartmentId, PeopleName, PeopleSex, PeoplePhone)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;006&#x27;</span>,<span class="comment">-- DepartmentId - varchar(10)</span></span><br><span class="line"><span class="string">&#x27;马超&#x27;</span>,<span class="comment">-- PeopleName - nvarchar(20)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span>,<span class="comment">-- PeopleSex - nvarchar(2)</span></span><br><span class="line"><span class="string">&#x27;13698547125&#x27;</span><span class="comment">-- PeoplePhone - nvarchar(20)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 触发器实现，删除一个部门的时候将部门下所有员工全部删除</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_DeleteDept <span class="keyword">on</span> Department after <span class="keyword">delete</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> People <span class="keyword">where</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> deleted)</span><br><span class="line">go</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试触发器</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dbo.Department <span class="keyword">where</span> DepartmentId <span class="operator">=</span> <span class="string">&#x27;006&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个触发器，删除一个部门的时候判断该部门下是否有员工，有则不删除，没有则删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> tri_DeleteDept</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_DeleteDept <span class="keyword">on</span> Department instead <span class="keyword">of</span> <span class="keyword">delete</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">if <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> deleted))</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dbo.Department <span class="keyword">where</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> deleted)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.People</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dbo.Department <span class="keyword">where</span> DepartmentId <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改一个部门编号后，将该部门下所有员工的部门编号同步进行修改</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_UpdateDept <span class="keyword">on</span> Department after <span class="keyword">update</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">update</span> People <span class="keyword">set</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> inserted) <span class="keyword">where</span> DepartmentId <span class="operator">=</span> (<span class="keyword">select</span> DepartmentId <span class="keyword">from</span> deleted)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.People</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> dbo.Department <span class="keyword">set</span> DepartmentId <span class="operator">=</span> <span class="string">&#x27;005&#x27;</span> <span class="keyword">where</span> DepartmentId <span class="operator">=</span> <span class="string">&#x27;001&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="3-存储过程"><a href="#3-存储过程" class="headerlink" title="3. 存储过程"></a>3. 存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 没有输入参数，没有输出参数的存储过程</span></span><br><span class="line"><span class="comment">-- 定义存储过程实现查询出账户余额最低的银行卡账户信息，显示银行卡号，姓名，账户余额</span></span><br><span class="line"><span class="keyword">drop</span> proc proc_MinMoneyCard</span><br><span class="line"><span class="keyword">create</span> proc proc_MinMoneyCard </span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">1</span> CardNo,RealName,CardMoney <span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId <span class="operator">=</span> BankCard.AccountId</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> CardMoney</span><br><span class="line">go</span><br><span class="line"><span class="comment">-- 方案二：(余额最低，多个人并列,都可以查出来)</span></span><br><span class="line"><span class="keyword">create</span> proc proc_MinMoneyCard </span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> CardNo,RealName,CardMoney <span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId <span class="operator">=</span> BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span> CardMoney <span class="operator">=</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">min</span>(CardMoney) <span class="keyword">from</span> dbo.BankCard)</span><br><span class="line">go</span><br><span class="line"><span class="keyword">exec</span> proc_MinMoneyCard</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有输入参数，没有输出参数的存储过程</span></span><br><span class="line"><span class="comment">--模拟银行卡存钱操作，传入银行卡号，存钱金额，实现存钱操作</span></span><br><span class="line"><span class="keyword">create</span> proc proc_Cunqian</span><br><span class="line"><span class="variable">@CardNo</span> <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line"><span class="variable">@money</span> money</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">update</span> dbo.BankCard <span class="keyword">set</span> CardMoney <span class="operator">=</span> CardMoney <span class="operator">+</span> <span class="variable">@money</span></span><br><span class="line"><span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="variable">@CardNo</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="variable">@CardNo</span>,<span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="variable">@money</span>,<span class="comment">-- MoneyInBank - money</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- MoneyOutBank - money</span></span><br><span class="line">getdate()<span class="comment">-- ExchangeTime - smalldatetime</span></span><br><span class="line">)</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"><span class="keyword">exec</span> proc_Cunqian <span class="string">&#x27;6225547858741263&#x27;</span>,<span class="number">1000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有输入参数，没有输出参数，但是有返回值的存储过程（返回值必须整数）</span></span><br><span class="line"><span class="comment">-- 模拟银行卡取钱操作，传入银行卡号，取钱金额，实现取钱操作</span></span><br><span class="line"><span class="comment">-- 取钱成功 返回1 ，取钱失败 返回-1</span></span><br><span class="line"><span class="keyword">create</span> proc proc_Quqian</span><br><span class="line"><span class="variable">@CardNo</span> <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line"><span class="variable">@money</span> money</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">update</span> dbo.BankCard <span class="keyword">set</span> CardMoney <span class="operator">=</span> CardMoney <span class="operator">-</span> <span class="variable">@money</span></span><br><span class="line"><span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="variable">@CardNo</span></span><br><span class="line">if @<span class="variable">@error</span> <span class="operator">&lt;&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="variable">@CardNo</span>,<span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- MoneyInBank - money</span></span><br><span class="line"><span class="variable">@money</span>,<span class="comment">-- MoneyOutBank - money</span></span><br><span class="line">getdate()<span class="comment">-- ExchangeTime - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@result</span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">exec</span> <span class="variable">@result</span> <span class="operator">=</span> proc_Quqian <span class="string">&#x27;6225125478544587&#x27;</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有输入参数，有输出参数的存储过程</span></span><br><span class="line"><span class="comment">-- 查询出某个时间段的银行存取款信息以及存款总金额，取款总金额</span></span><br><span class="line"><span class="comment">-- 传入开始时间，结束时间，显示存取款交易信息的同时，返回存款总金额，取款总金额</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> proc proc_selectExChange</span><br><span class="line"><span class="variable">@start</span> <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"><span class="variable">@end</span> <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"><span class="variable">@sumIn</span> money output,</span><br><span class="line"><span class="variable">@sumOut</span> money output</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sumIn</span> <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">sum</span>(MoneyInBank) <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"><span class="keyword">where</span> ExchangeTime <span class="keyword">between</span> <span class="variable">@start</span> <span class="operator">+</span> <span class="string">&#x27; 00:00:00&#x27;</span> <span class="keyword">and</span> <span class="variable">@end</span> <span class="operator">+</span> <span class="string">&#x27; 23:59:59&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sumOut</span> <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">sum</span>(MoneyOutBank) <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"><span class="keyword">where</span> ExchangeTime <span class="keyword">between</span> <span class="variable">@start</span> <span class="operator">+</span> <span class="string">&#x27; 00:00:00&#x27;</span> <span class="keyword">and</span> <span class="variable">@end</span> <span class="operator">+</span> <span class="string">&#x27; 23:59:59&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"><span class="keyword">where</span> ExchangeTime <span class="keyword">between</span> <span class="variable">@start</span> <span class="operator">+</span> <span class="string">&#x27; 00:00:00&#x27;</span> <span class="keyword">and</span> <span class="variable">@end</span> <span class="operator">+</span> <span class="string">&#x27; 23:59:59&#x27;</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@sumIn</span> money</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@sumOut</span> money</span><br><span class="line"><span class="keyword">exec</span> proc_selectExChange <span class="string">&#x27;2020-01-01&#x27;</span>,<span class="string">&#x27;2022-12-11&#x27;</span>,<span class="variable">@sumIn</span> output,<span class="variable">@sumOut</span> output</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sumIn</span></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@sumOut</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 具有同时输入输出参数的存储过程</span></span><br><span class="line"><span class="comment">--密码升级，传入用户名和密码，如果用户名密码正确，并且密码长度&lt;8 自动升级成8位密码</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">floor</span>(rand() <span class="operator">*</span> <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> proc procPwdUpgrade</span><br><span class="line"><span class="variable">@CardNo</span> nvarchar(<span class="number">20</span>),</span><br><span class="line"><span class="variable">@pwd</span> nvarchar(<span class="number">20</span>) output</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">if <span class="keyword">not</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="variable">@CardNo</span> <span class="keyword">and</span> CardPwd <span class="operator">=</span> <span class="variable">@pwd</span>)</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@pwd</span> <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">if len(<span class="variable">@pwd</span>) <span class="operator">&lt;</span> <span class="number">8</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@len</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">8</span> <span class="operator">-</span> len(<span class="variable">@pwd</span>)</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">while <span class="variable">@i</span> <span class="operator">&lt;=</span> <span class="variable">@len</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@pwd</span> <span class="operator">=</span> <span class="variable">@pwd</span> <span class="operator">+</span> <span class="built_in">cast</span>(<span class="built_in">floor</span>(rand() <span class="operator">*</span> <span class="number">10</span>) <span class="keyword">as</span> <span class="type">varchar</span>(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@i</span> <span class="operator">=</span> <span class="variable">@i</span> <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">update</span> dbo.BankCard <span class="keyword">set</span> CardPwd <span class="operator">=</span> <span class="variable">@pwd</span> <span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="variable">@CardNo</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@pwd</span> nvarchar(<span class="number">20</span>) <span class="operator">=</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"><span class="keyword">exec</span> procPwdUpgrade <span class="string">&#x27;6225125478544587&#x27;</span>,<span class="variable">@pwd</span> output</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@pwd</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>17.事务-索引-视图-游标</title>
    <link href="http://example.com/2022/12/04/SqlServer/17.%E4%BA%8B%E5%8A%A1-%E7%B4%A2%E5%BC%95-%E8%A7%86%E5%9B%BE-%E6%B8%B8%E6%A0%87/"/>
    <id>http://example.com/2022/12/04/SqlServer/17.%E4%BA%8B%E5%8A%A1-%E7%B4%A2%E5%BC%95-%E8%A7%86%E5%9B%BE-%E6%B8%B8%E6%A0%87/</id>
    <published>2022-12-04T08:17:57.876Z</published>
    <updated>2022-12-05T09:26:52.535Z</updated>
    
    <content type="html"><![CDATA[<h1 id="事务-索引-视图-游标"><a href="#事务-索引-视图-游标" class="headerlink" title="事务-索引-视图-游标"></a>事务-索引-视图-游标</h1><h2 id="1-事务"><a href="#1-事务" class="headerlink" title="1. 事务"></a>1. 事务</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假设刘备取款6000 </span></span><br><span class="line"><span class="comment">-- 要求使用事务实现，修改余额和添加取款记录两部操作使用事务</span></span><br><span class="line"><span class="keyword">begin</span> transaction;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@myError</span> <span class="type">int</span><span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">update</span>dbo.BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="number">-1</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225125478544587&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@myError</span> <span class="operator">+</span><span class="operator">=</span> @<span class="variable">@error</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225125478544587&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- MoneyInBank - money</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- MoneyOutBank - money</span></span><br><span class="line">getdate()<span class="comment">-- ExchangeTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@myError</span> <span class="operator">+</span><span class="operator">=</span> @<span class="variable">@error</span>;</span><br><span class="line">if <span class="variable">@myError</span><span class="operator">=</span><span class="number">0</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;取款成功&#x27;</span>;</span><br><span class="line"><span class="keyword">commit</span> transaction;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;取款失败&#x27;</span>;</span><br><span class="line"><span class="keyword">rollback</span> transaction;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设刘备向张飞转账1000元</span></span><br><span class="line"><span class="comment">-- 步骤有三步 张飞添加1000元，刘备扣除1000元 生成转账记录</span></span><br><span class="line"><span class="keyword">begin</span> transaction</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@myError</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">update</span> dbo.BankCard <span class="keyword">set</span> CardMoney <span class="operator">=</span> CardMoney <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="string">&#x27;6225547854125656&#x27;</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@myError</span> <span class="operator">+</span><span class="operator">=</span> @<span class="variable">@error</span></span><br><span class="line"><span class="keyword">update</span> dbo.BankCard <span class="keyword">set</span> CardMoney <span class="operator">=</span> CardMoney <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="string">&#x27;6225125478544587&#x27;</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@myError</span> <span class="operator">+</span><span class="operator">=</span> @<span class="variable">@error</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardTransfer (CardNoOut, CardNoIn, TransferMoney, TransferTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225125478544587&#x27;</span>,<span class="comment">-- CardNoOut - varchar(30)</span></span><br><span class="line"><span class="string">&#x27;6225547854125656&#x27;</span>,<span class="comment">-- CardNoIn - varchar(30)</span></span><br><span class="line"><span class="number">1000</span>,<span class="comment">-- TransferMoney - money</span></span><br><span class="line">getdate()<span class="comment">-- TransferTime - smalldatetime</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@myError</span> <span class="operator">+</span><span class="operator">=</span> @<span class="variable">@error</span></span><br><span class="line">if <span class="variable">@myError</span><span class="operator">=</span><span class="number">0</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;转账成功&#x27;</span>;</span><br><span class="line"><span class="keyword">commit</span> transaction;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;转账失败&#x27;</span>;</span><br><span class="line"><span class="keyword">rollback</span> transaction;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h2 id="2-索引"><a href="#2-索引" class="headerlink" title="2. 索引"></a>2. 索引</h2><blockquote><p>  索引：提高检索查询效率</p></blockquote><p><strong>SQL SERVER 索引类型：</strong>按照存储结构区分：“聚集索引（又称聚类索引，簇集索引）”，”非聚集索引（非聚类索引，非簇集索引）”</p><p>聚集索引：根据数据行的键值在表或视图中的排序存储这些数据行，每个表只有一个聚集索引。聚集索引是一种对<br>磁盘上实际数据重新组织以按指定的一列或多列值排序（类似字典中的拼音索引）（物理存储顺序）。<br>非聚集索引：具有独立于数据行的结构，包含非聚集索引键值，且每个键值项都有指向包含该键值的数据行的指<br>针。（类似字典中的偏旁部首索引）（逻辑存储顺序）。</p><p><strong>SQL SERVER索引其他分类：</strong><br>按数据唯一性区分：“唯一索引”，“非唯一索引”；按键列个数区分：“单列索引”，“多列索引”。</p><p>创建索引的方式：</p><ol><li>通过显式的CREATE INDEX命令</li><li>在创建约束时作为隐含的对象<ol><li>主键约束（聚集索引）</li><li>唯一约束（唯一索引）</li></ol></li></ol><p><strong>创建索引语法：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span>][CLUSTERED NONCLUSTERED]</span><br><span class="line">INDEX <span class="operator">&lt;</span>index name<span class="operator">&gt;</span><span class="keyword">ON</span> <span class="operator">&lt;</span><span class="keyword">table</span> <span class="keyword">or</span> <span class="keyword">view</span> name<span class="operator">&gt;</span>(<span class="operator">&lt;</span><span class="keyword">column</span> name<span class="operator">&gt;</span>[<span class="keyword">ASC</span> <span class="operator">|</span><span class="keyword">DESC</span>][,...n])</span><br></pre></td></tr></table></figure><p><strong>索引基本示例语法：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- exp:创建一个非聚集索引</span></span><br><span class="line"><span class="comment">-- create nonclustered index indexAccount on AccountInfo(AccountCode)</span></span><br><span class="line"><span class="comment">-- 除一个索引</span></span><br><span class="line"><span class="comment">-- drop index indexAccount on AccountInfo</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给AccountInfo 表中的AccountCode字段添加索引</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> nonclustered index index_code</span><br><span class="line"><span class="keyword">on</span> dbo.AccountInfo (AccountCode);</span><br><span class="line"><span class="keyword">with</span></span><br><span class="line">(</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 索引查看</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.indexes <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;index_code&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引的删除</span></span><br><span class="line"><span class="keyword">drop</span> index index_code <span class="keyword">on</span> dbo.AccountInfo</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">with</span>(index <span class="operator">=</span> index_code) <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="3-视图"><a href="#3-视图" class="headerlink" title="3. 视图"></a>3. 视图</h2><blockquote><p>  视图：可以理解成虚拟表。</p></blockquote><ol><li>编写视图实现查询出所有银行卡账户信息，显示卡号，身份证，姓名，余额。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> CardAndAccount <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额 <span class="keyword">from</span> BankCard</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> AccountInfo <span class="keyword">on</span> BankCard.AccountId <span class="operator">=</span> AccountInfo.AccountId</span><br><span class="line">go</span><br></pre></td></tr></table></figure><p>如果要进行相应信息的查询，不需要编写复杂的SQL语句，直接使用视图，如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> CardAndAccount</span><br></pre></td></tr></table></figure><h2 id="4-游标"><a href="#4-游标" class="headerlink" title="4. 游标"></a>4. 游标</h2><blockquote><p>  游标：定位到结果集中某一行。</p></blockquote><p>游标分类：</p><ol><li>静态游标(Static):在操作游标的时候，数据发生变化，游标中数据不变</li><li>动态游标(Dynamic):在操作游标的时候，数据发生变化，游标中数据改变，默认值。</li><li>键集驱动游标(KeySet):在操作游标的时候，被标识的列发生改变，游标中数据改变，其他列改变，游标中<br>数据不变。</li></ol><p>假设有如下表结构和数据：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">Member</span> (MemberId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line"> MemberAccount nvarchar(<span class="number">20</span>) <span class="keyword">unique</span> <span class="keyword">check</span> (len(MemberAccount) <span class="keyword">between</span> <span class="number">6</span> <span class="keyword">and</span> <span class="number">12</span>),</span><br><span class="line"> MemberPwd nvarchar(<span class="number">20</span>),</span><br><span class="line"> MemberNickname nvarchar(<span class="number">20</span>),</span><br><span class="line"> MemberPhone nvarchar(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Member</span> (MemberAccount,MemberPwd,MemberNickname,MemberPhone)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;liubei&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="string">&#x27;4659874564&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Member</span> (MemberAccount,MemberPwd,MemberNickname,MemberPhone)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;guanyu&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;关羽&#x27;</span>,<span class="string">&#x27;42354234124&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Member</span> (MemberAccount,MemberPwd,MemberNickname,MemberPhone)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;zhangfei&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张飞&#x27;</span>,<span class="string">&#x27;41253445&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Member</span> (MemberAccount,MemberPwd,MemberNickname,MemberPhone)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;zhangyun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;赵云&#x27;</span>,<span class="string">&#x27;75675676547&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Member</span> (MemberAccount,MemberPwd,MemberNickname,MemberPhone)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;machao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;马超&#x27;</span>,<span class="string">&#x27;532523523&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>游标操作：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建游标(scroll:滚动游标，没有scroll,只进)</span></span><br><span class="line"><span class="keyword">declare</span> mycur <span class="keyword">cursor</span> <span class="keyword">scroll</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">select</span> MemberAccount <span class="keyword">from</span> dbo.Member</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打开游标</span></span><br><span class="line"><span class="keyword">open</span> mycur</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提取某行的数据</span></span><br><span class="line"><span class="keyword">fetch</span> <span class="keyword">first</span> <span class="keyword">from</span> mycur <span class="comment">-- 第一行</span></span><br><span class="line"><span class="keyword">fetch</span> <span class="keyword">last</span> <span class="keyword">from</span> mycur <span class="comment">-- 最后一行</span></span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">2</span> <span class="keyword">from</span> mycur <span class="comment">-- 提取第二行</span></span><br><span class="line"><span class="keyword">fetch</span> relative <span class="number">2</span> <span class="keyword">from</span> mycur <span class="comment">-- 当前行下移2行</span></span><br><span class="line"><span class="keyword">fetch</span> next <span class="keyword">from</span> mycur <span class="comment">-- 下移一行</span></span><br><span class="line"><span class="keyword">fetch</span> prior <span class="keyword">from</span> mycur <span class="comment">-- 上移一行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提取游标数据存入变量，进行查询所有列信息</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@acc</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">2</span> <span class="keyword">from</span> mycur <span class="keyword">into</span> <span class="variable">@acc</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">Member</span> <span class="keyword">where</span> MemberAccount <span class="operator">=</span> <span class="variable">@acc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 遍历游标</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@acc</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">1</span> <span class="keyword">from</span> mycur <span class="keyword">into</span> <span class="variable">@acc</span></span><br><span class="line"><span class="comment">-- @@fetch_status:0 提取失败，-1失败，-2不存在</span></span><br><span class="line">while @<span class="variable">@fetch</span>_status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;提取成功:&#x27;</span> <span class="operator">+</span> <span class="variable">@acc</span></span><br><span class="line"><span class="keyword">fetch</span> next <span class="keyword">from</span> mycur <span class="keyword">into</span> <span class="variable">@acc</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 利用游标进行数据的修改和删除</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Member</span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">2</span> <span class="keyword">from</span> mycur</span><br><span class="line"><span class="keyword">update</span> dbo.Member <span class="keyword">set</span> MemberPwd <span class="operator">=</span> <span class="string">&#x27;654321&#x27;</span> <span class="keyword">where</span> <span class="keyword">current</span> <span class="keyword">of</span> mycur</span><br><span class="line"></span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">2</span> <span class="keyword">from</span> mycur</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> dbo.Member <span class="keyword">where</span> <span class="keyword">current</span> <span class="keyword">of</span> mycur</span><br><span class="line"><span class="comment">-- 关闭游标</span></span><br><span class="line"><span class="keyword">close</span> mycur</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除游标</span></span><br><span class="line"><span class="keyword">deallocate</span> mycur</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建指向某行多列的游标，循环显示多列数据</span></span><br><span class="line"><span class="keyword">declare</span> mycur <span class="keyword">cursor</span> <span class="keyword">scroll</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">select</span> MemberAccount,MemberPwd,MemberNickName <span class="keyword">from</span> dbo.Member</span><br><span class="line"><span class="comment">-- 打开游标</span></span><br><span class="line"><span class="keyword">open</span> mycur</span><br><span class="line"><span class="comment">-- 多列游标打印</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@acc</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@pwd</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@nickname</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">fetch</span> absolute <span class="number">1</span> <span class="keyword">from</span> mycur <span class="keyword">into</span> <span class="variable">@acc</span>,<span class="variable">@pwd</span>,<span class="variable">@nickname</span></span><br><span class="line"></span><br><span class="line">while @<span class="variable">@fetch</span>_status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;用户名：&#x27;</span> <span class="operator">+</span> <span class="variable">@acc</span> <span class="operator">+</span> <span class="string">&#x27;,密码：&#x27;</span> <span class="operator">+</span> <span class="variable">@pwd</span> <span class="operator">+</span> <span class="string">&#x27;,昵称：&#x27;</span> <span class="operator">+</span> <span class="variable">@nickname</span></span><br><span class="line"><span class="keyword">fetch</span> next <span class="keyword">from</span> mycur <span class="keyword">into</span> <span class="variable">@acc</span>,<span class="variable">@pwd</span>,<span class="variable">@nickname</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 关闭游标</span></span><br><span class="line"><span class="keyword">close</span> mycur</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除游标</span></span><br><span class="line"><span class="keyword">deallocate</span> mycur</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>16. 分页</title>
    <link href="http://example.com/2022/12/04/SqlServer/16.%E5%88%86%E9%A1%B5/"/>
    <id>http://example.com/2022/12/04/SqlServer/16.%E5%88%86%E9%A1%B5/</id>
    <published>2022-12-04T07:26:14.599Z</published>
    <updated>2022-12-05T09:27:08.494Z</updated>
    
    <content type="html"><![CDATA[<h1 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student</span><br><span class="line">(</span><br><span class="line">StuId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">StuSex <span class="type">varchar</span>(<span class="number">4</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;刘备&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;关羽&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;张飞&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;赵云&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;马超&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;黄忠&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;魏延&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;诸葛亮&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;赵怀真&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;夏侯惇&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;百里玄策&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;阿猫&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;阿狗&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;孙尚香&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;公孙离&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;小乔&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;大乔&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;孙策&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;猪八戒&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;孙悟空&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;沙和尚&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;唐僧&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;如来佛祖&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;玉皇大帝&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;东方耀&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;百里守约&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;鲁班七号&#x27;</span>,<span class="string">&#x27;男&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;西施&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;不知火舞&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuName,StuSex)<span class="keyword">values</span>(<span class="string">&#x27;花木兰&#x27;</span>,<span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Student</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Student </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> StuId) RowId,<span class="operator">*</span> <span class="keyword">from</span> dbo.Student) temp</span><br><span class="line"><span class="keyword">where</span> RowId <span class="keyword">between</span> (当前页<span class="number">-1</span>)<span class="operator">*</span>页码大小<span class="operator">+</span><span class="number">1</span> <span class="keyword">and</span> 当前页<span class="operator">*</span>页码大小</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@PageSize</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@PageIndex</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> StuId) RowId,<span class="operator">*</span> <span class="keyword">from</span> dbo.Student) temp</span><br><span class="line"><span class="keyword">where</span> RowId <span class="keyword">between</span> (<span class="variable">@PageIndex</span><span class="number">-1</span>)<span class="operator">*</span><span class="variable">@PageSize</span><span class="operator">+</span><span class="number">1</span> <span class="keyword">and</span> <span class="variable">@PageIndex</span><span class="operator">*</span><span class="variable">@PageSize</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>15. 子查询</title>
    <link href="http://example.com/2022/12/04/SqlServer/15.%E5%AD%90%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/12/04/SqlServer/15.%E5%AD%90%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-12-04T06:31:14.479Z</published>
    <updated>2022-12-05T09:27:27.083Z</updated>
    
    <content type="html"><![CDATA[<h1 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关羽的银行卡号为&#x27;6225547858741263&#x27;</span></span><br><span class="line"><span class="comment">-- 查询出余额比关羽多的银行卡信息，显示卡号，身份证，姓名，余额</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@balance</span> money;</span><br><span class="line"><span class="keyword">select</span><span class="variable">@balance</span><span class="operator">=</span> (<span class="keyword">select</span> CardMoney  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardNo<span class="operator">=</span><span class="string">&#x27;6225547858741263&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>CardMoney<span class="operator">&gt;</span><span class="variable">@balance</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>CardMoney<span class="operator">&gt;</span> (<span class="keyword">select</span> CardMoney  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardNo<span class="operator">=</span><span class="string">&#x27;6225547858741263&#x27;</span>);</span><br><span class="line"><span class="comment">-- 从所有账户信息中查询出余额最高的交易明细(存钱取钱信息)</span></span><br><span class="line"><span class="keyword">select</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span>dbo.CardExchange</span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span> (<span class="keyword">select</span> top <span class="number">1</span> CardNo   <span class="keyword">from</span> dbo.BankCard <span class="keyword">order</span> <span class="keyword">by</span> CardMoney  <span class="keyword">desc</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询有取款记录的银行卡及账户信息，显示卡号身份证姓名余额</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">BankCard.CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>CardNo <span class="keyword">in</span> (<span class="keyword">select</span> CardNo   <span class="keyword">from</span> dbo.CardExchange <span class="keyword">where</span> MoneyOutBank<span class="operator">&gt;</span><span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出没有存款记录的银行卡及账户信息，显示卡号身份证姓名余额</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">BankCard.CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>CardNo <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> CardNo   <span class="keyword">from</span> dbo.CardExchange <span class="keyword">where</span> MoneyInBank<span class="operator">&gt;</span><span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard;</span><br><span class="line"><span class="keyword">update</span>dbo.BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="number">-100</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547854125656&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span>dbo.BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="operator">+</span><span class="number">100</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547858741263&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardTransfer (CardNoOut, CardNoIn, TransferMoney, TransferTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547854125656&#x27;</span>, <span class="comment">-- CardNoOut - varchar(30)</span></span><br><span class="line"><span class="string">&#x27;6225547858741263&#x27;</span>, <span class="comment">-- CardNoIn - varchar(30)</span></span><br><span class="line"><span class="number">100</span>,<span class="comment">-- TransferMoney - money</span></span><br><span class="line">getdate()<span class="comment">-- TransferTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 关羽的银行卡号为&#x27;6225547858741263&#x27;,查询当天是否收到转账</span></span><br><span class="line">if <span class="keyword">exists</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span>dbo.CardTransfer</span><br><span class="line"><span class="keyword">where</span>CardNoIn<span class="operator">=</span><span class="string">&#x27;6225547858741263&#x27;</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">convert</span>(<span class="type">varchar</span>(<span class="number">22</span>), getdate(), <span class="number">23</span>)<span class="operator">=</span><span class="keyword">convert</span>(<span class="type">varchar</span>(<span class="number">22</span>), TransferTime, <span class="number">23</span>)</span><br><span class="line">) <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;有收到转账&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;没有收到转账&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出交易次数最多的银行卡信息</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">BankCard.CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额, temp.myCount 交易次数</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">select</span> CardNo, <span class="built_in">count</span>(<span class="operator">*</span>) myCount <span class="keyword">from</span> dbo  .CardExchange <span class="keyword">group</span> <span class="keyword">by</span> CardNo  ) temp <span class="keyword">on</span> temp.CardNo<span class="operator">=</span>BankCard.CardNo</span><br><span class="line"><span class="keyword">where</span>temp.myCount<span class="operator">=</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(temp.myCount)</span><br><span class="line"><span class="keyword">from</span> ( <span class="keyword">select</span> CardNo, <span class="built_in">count</span>(<span class="operator">*</span>) myCount <span class="keyword">from</span>  dbo.CardExchange <span class="keyword">group</span> <span class="keyword">by</span>   CardNo) temp</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出没有转账交易记录的银行卡账户信息，显示卡号、身份证、姓名、余额</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">BankCard.CardNo 卡号, AccountCode 身份证, RealName 姓名, CardMoney 余额</span><br><span class="line"><span class="keyword">from</span>dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>CardNo <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> CardNo   <span class="keyword">from</span> dbo.CardTransfer <span class="keyword">where</span> CardNo<span class="operator">=</span>CardNoIn)</span><br><span class="line"><span class="keyword">and</span> CardNo <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> CardNo   <span class="keyword">from</span> dbo.CardTransfer <span class="keyword">where</span> CardNo<span class="operator">=</span>CardNoOut);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>14. 流程控制</title>
    <link href="http://example.com/2022/12/04/SqlServer/14.%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
    <id>http://example.com/2022/12/04/SqlServer/14.%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</id>
    <published>2022-12-04T06:02:02.077Z</published>
    <updated>2022-12-05T09:27:39.598Z</updated>
    
    <content type="html"><![CDATA[<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="1-选择分支结构"><a href="#1-选择分支结构" class="headerlink" title="1. 选择分支结构"></a>1. 选择分支结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.CardExchange</span><br><span class="line"><span class="comment">-- 某用户银行卡号为&quot;6225547854125656&quot;,</span></span><br><span class="line"><span class="comment">-- 该用户执行取钱操作，取钱5000元，余额充足则进行取钱操作</span></span><br><span class="line"><span class="comment">-- 并提示&quot;取钱成功&quot;，否则提示&quot;余额不足&quot;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@balance</span> money;</span><br><span class="line"><span class="keyword">select</span><span class="variable">@balance</span><span class="operator">=</span> (<span class="keyword">select</span> CardMoney  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardNo<span class="operator">=</span><span class="string">&#x27;6225547854125656&#x27;</span>);</span><br><span class="line"></span><br><span class="line">if <span class="number">5000</span><span class="operator">&lt;=</span><span class="variable">@balance</span> <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">update</span>dbo.BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="number">-5000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547854125656&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547854125656&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- MoneyInBank - money</span></span><br><span class="line"><span class="number">5000</span>,<span class="comment">-- MoneyOutBank - money</span></span><br><span class="line">getdate()<span class="comment">-- ExchangeTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line">print <span class="string">&#x27;取钱成功&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">print <span class="string">&#x27;余额不足&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询银行卡信息，将银行卡状态1，2，3，4分别转换为汉字 ”正常，挂失，冻结，注销“，</span></span><br><span class="line"><span class="comment">-- 并且根据银行卡余额显示银行卡等级</span></span><br><span class="line"><span class="comment">-- 30万以下为普通用户，30万以上为vip用户</span></span><br><span class="line"><span class="comment">-- 显示列分别为卡号、身份证、姓名、余额、用户等级、银行卡状态</span></span><br><span class="line"><span class="keyword">select</span> CardNo 卡号,AccountCode 身份证号,RealName 姓名, CardMoney 余额,</span><br><span class="line"><span class="keyword">case</span> </span><br><span class="line"><span class="keyword">when</span> CardMoney <span class="operator">&gt;=</span> <span class="number">300000</span> <span class="keyword">then</span> <span class="string">&#x27;VIP用户&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;普通用户&#x27;</span></span><br><span class="line"><span class="keyword">end</span> 用户等级,</span><br><span class="line"><span class="keyword">case</span> CardState</span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;正常&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;挂失&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;冻结&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;注销&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;异常&#x27;</span></span><br><span class="line"><span class="keyword">end</span> 银行卡状态</span><br><span class="line"><span class="keyword">from</span> dbo.BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.AccountInfo <span class="keyword">on</span> AccountInfo.AccountId <span class="operator">=</span> BankCard.AccountId</span><br></pre></td></tr></table></figure><h2 id="2-循环分支结构"><a href="#2-循环分支结构" class="headerlink" title="2. 循环分支结构"></a>2. 循环分支结构</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 循环结构</span></span><br><span class="line"><span class="comment">-- 循环打印1-10</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">while <span class="variable">@i</span> <span class="operator">&lt;=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print <span class="variable">@i</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@i</span> <span class="operator">+</span><span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 循环打印九九乘法表</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">while <span class="variable">@i</span> <span class="operator">&lt;=</span> <span class="number">9</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@str</span> <span class="type">varchar</span>(<span class="number">500</span>) <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@j</span> <span class="type">int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">while <span class="variable">@j</span> <span class="operator">&lt;=</span> <span class="variable">@i</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@str</span> <span class="operator">=</span> <span class="variable">@str</span> <span class="operator">+</span> <span class="built_in">cast</span>(<span class="variable">@i</span> <span class="keyword">as</span> <span class="type">varchar</span>(<span class="number">1</span>)) <span class="operator">+</span> <span class="string">&#x27;*&#x27;</span> <span class="operator">+</span> <span class="built_in">cast</span>(<span class="variable">@j</span> <span class="keyword">as</span> <span class="type">varchar</span>(<span class="number">1</span>)) <span class="operator">+</span> <span class="string">&#x27;=&#x27;</span><span class="operator">+</span> <span class="built_in">cast</span>(<span class="variable">@i</span> <span class="operator">*</span> <span class="variable">@j</span> <span class="keyword">as</span> <span class="type">varchar</span>(<span class="number">2</span>)) <span class="operator">+</span> <span class="string">&#x27;  &#x27;</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@j</span> <span class="operator">+</span><span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">print <span class="variable">@str</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@i</span> <span class="operator">+</span><span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>13. 运算符</title>
    <link href="http://example.com/2022/12/03/SqlServer/13.%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    <id>http://example.com/2022/12/03/SqlServer/13.%E8%BF%90%E7%AE%97%E7%AC%A6/</id>
    <published>2022-12-03T08:36:35.870Z</published>
    <updated>2022-12-05T09:27:55.334Z</updated>
    
    <content type="html"><![CDATA[<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><blockquote><p>  T-SQL中运算符分为7种</p></blockquote><table><thead><tr><th>种类</th><th>运算符</th></tr></thead><tbody><tr><td>算数运算符</td><td>+ - * &#x2F; %</td></tr><tr><td>逻辑运算符</td><td>and、or、like、between、in、exists、not、all、any</td></tr><tr><td>赋值运算符</td><td>&#x3D;</td></tr><tr><td>字符串运算符</td><td>+</td></tr><tr><td>比较运算符</td><td>&#x3D; &gt; &lt; &gt;&#x3D; &lt;&#x3D; &lt;&gt;</td></tr><tr><td>位运算符</td><td>!、&amp;、^</td></tr><tr><td>符合运算符</td><td>+&#x3D; -&#x3D; &#x2F;&#x3D; *&#x3D; %&#x3D;</td></tr></tbody></table><p>练习：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 已知长方形的长和宽，求长方形的周长和面积</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@len</span> <span class="type">int</span><span class="operator">=</span><span class="number">10</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@wid</span> <span class="type">int</span><span class="operator">=</span><span class="number">5</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@zc</span> <span class="type">int</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@mj</span> <span class="type">int</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@zc</span><span class="operator">=</span> (<span class="variable">@len</span><span class="operator">+</span><span class="variable">@wid</span>) <span class="operator">*</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@mj</span><span class="operator">=</span><span class="variable">@len</span> <span class="operator">*</span> <span class="variable">@wid</span>;</span><br><span class="line">print <span class="string">&#x27;周长&#x27;</span><span class="operator">+</span><span class="keyword">convert</span>(<span class="type">varchar</span>(<span class="number">10</span>), <span class="variable">@zc</span>);</span><br><span class="line">print <span class="string">&#x27;面积&#x27;</span><span class="operator">+</span><span class="keyword">convert</span>(<span class="type">varchar</span>(<span class="number">10</span>), <span class="variable">@mj</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询银行卡状态为冻结，并且余额超过1000000的银行卡信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardState<span class="operator">=</span><span class="number">3</span> <span class="keyword">and</span> CardMoney<span class="operator">&gt;</span><span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出银行卡状态为冻结，或者余额0的银行卡信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardState<span class="operator">=</span><span class="number">3</span> <span class="keyword">or</span> CardMoney <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出姓名中含有&#x27;刘&#x27;的账户信息以及银行卡信息</span></span><br><span class="line"><span class="keyword">select</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span>dbo.AccountInfo</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.BankCard <span class="keyword">on</span> AccountInfo.AccountId<span class="operator">=</span>dbo.BankCard.AccountId</span><br><span class="line"><span class="keyword">where</span>dbo.AccountInfo.RealName <span class="keyword">like</span> <span class="string">&#x27;%刘%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出余额再2000-5000之间的银行卡信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardMoney  <span class="keyword">between</span> <span class="number">2000</span> <span class="keyword">and</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出银行卡状态为冻结或者注销的银行卡信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> CardState  <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询身份证在账户表是否存在，不存在进行开户开发，存在则不开户直接开卡</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@AccountId</span> <span class="type">int</span>;</span><br><span class="line">if <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>) <span class="comment">-- 存在此人</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">select</span><span class="variable">@AccountId</span><span class="operator">=</span> (<span class="keyword">select</span> AccountId <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState, CardTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741264&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="variable">@AccountId</span>,<span class="comment">-- AccountId - int</span></span><br><span class="line"><span class="string">&#x27;123456&#x27;</span>,<span class="comment">-- CardPwd - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- CardMoney - money</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- CardState - int</span></span><br><span class="line">getdate()<span class="comment">-- CardTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">-- 不存在此人</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.AccountInfo (AccountCode, AccountPhone, RealName, OpenTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;420107199507104133&#x27;</span>,<span class="comment">-- AccountCode - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;13656565656&#x27;</span>,<span class="comment">-- AccountPhone - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>,<span class="comment">-- RealName - varchar(20)</span></span><br><span class="line">getdate()<span class="comment">-- OpenTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@AccountId</span><span class="operator">=</span>@<span class="variable">@identity</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState, CardTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741264&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="variable">@AccountId</span>,<span class="comment">-- AccountId - int</span></span><br><span class="line"><span class="string">&#x27;123456&#x27;</span>,<span class="comment">-- CardPwd - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- CardMoney - money</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- CardState - int</span></span><br><span class="line">getdate()<span class="comment">-- CardTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 拓展：上面需求添加一个限制即一个人最多只能开3张银行卡</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@AccountId</span> <span class="type">int</span>; <span class="comment">-- 账户编号</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@CardCount</span> <span class="type">int</span>; <span class="comment">-- 开卡数量</span></span><br><span class="line">if <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>) <span class="comment">-- 存在此人</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">select</span><span class="variable">@AccountId</span><span class="operator">=</span> (<span class="keyword">select</span> AccountId <span class="keyword">from</span> dbo.AccountInfo <span class="keyword">where</span> AccountCode   <span class="operator">=</span><span class="string">&#x27;420107199507104133&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@CardCount</span> <span class="operator">=</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dbo.BankCard <span class="keyword">where</span> AccountId <span class="operator">=</span> <span class="variable">@AccountId</span></span><br><span class="line">if <span class="variable">@CardCount</span> <span class="operator">&lt;=</span> <span class="number">2</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState, CardTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741264&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="variable">@AccountId</span>,<span class="comment">-- AccountId - int</span></span><br><span class="line"><span class="string">&#x27;123456&#x27;</span>,<span class="comment">-- CardPwd - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- CardMoney - money</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- CardState - int</span></span><br><span class="line">getdate()<span class="comment">-- CardTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print(<span class="string">&#x27;已经达到开卡上线&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">-- 不存在此人</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.AccountInfo (AccountCode, AccountPhone, RealName, OpenTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;420107199507104133&#x27;</span>,<span class="comment">-- AccountCode - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;13656565656&#x27;</span>,<span class="comment">-- AccountPhone - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>,<span class="comment">-- RealName - varchar(20)</span></span><br><span class="line">getdate()<span class="comment">-- OpenTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@AccountId</span><span class="operator">=</span>@<span class="variable">@identity</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState, CardTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741264&#x27;</span>, <span class="comment">-- CardNo - varchar(30)</span></span><br><span class="line"><span class="variable">@AccountId</span>,<span class="comment">-- AccountId - int</span></span><br><span class="line"><span class="string">&#x27;123456&#x27;</span>,<span class="comment">-- CardPwd - varchar(30)</span></span><br><span class="line"><span class="number">0</span>,<span class="comment">-- CardMoney - money</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- CardState - int</span></span><br><span class="line">getdate()<span class="comment">-- CardTime - smalldatetime</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询银行账户余额，是不是所有的余额都超过了3000</span></span><br><span class="line">if <span class="number">3000</span> <span class="operator">&lt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> CardMoney <span class="keyword">from</span> dbo.BankCard) </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print(<span class="string">&#x27;是的&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print(<span class="string">&#x27;不是的&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询银行卡账户余额，是否含有账户余额超过300000000的信息</span></span><br><span class="line">if  <span class="number">300000000</span> <span class="operator">&lt;</span> <span class="keyword">any</span>(<span class="keyword">select</span> CardMoney <span class="keyword">from</span> dbo.BankCard)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print(<span class="string">&#x27;是的&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">print(<span class="string">&#x27;不是的&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>12. T-SQL</title>
    <link href="http://example.com/2022/12/03/SqlServer/12.T-SQL%E7%BC%96%E7%A8%8B/"/>
    <id>http://example.com/2022/12/03/SqlServer/12.T-SQL%E7%BC%96%E7%A8%8B/</id>
    <published>2022-12-03T07:53:41.109Z</published>
    <updated>2022-12-05T09:28:56.935Z</updated>
    
    <content type="html"><![CDATA[<h1 id="T-SQL编程"><a href="#T-SQL编程" class="headerlink" title="T-SQL编程"></a>T-SQL编程</h1><h2 id="1-信息打印"><a href="#1-信息打印" class="headerlink" title="1. 信息打印"></a>1. 信息打印</h2><blockquote><p>  –print:直接打印信息</p><p>  –select:在表格中打印信息，可以设置多列，以及每一列的名字</p></blockquote><h2 id="2-变量"><a href="#2-变量" class="headerlink" title="2. 变量"></a>2. 变量</h2><p><strong>T-SQL中变量分别为局部变量和全局变量</strong></p><p><strong>局部变量：1. 以@作为前缀 2. 先声明后赋值</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@str</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@str</span> <span class="operator">=</span> <span class="string">&#x27;我爱数据库编程&#x27;</span> <span class="comment">-- 或者 select @str = &#x27;我爱数据库编程&#x27;</span></span><br><span class="line">print <span class="variable">@str</span></span><br></pre></td></tr></table></figure><p>备注：set赋值和select赋值的区别：</p><p>set:赋给变量指定的值</p><p>select:一般用于从表中查询出的数据，查询记录如果有多条，将最后一条记录的值赋给变量，例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @变量名 <span class="operator">=</span> 字段名 <span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure><p>在赋值过程中，如果是表中查询的数据，如果记录只有一条，使用set和select都可以，但是习惯上使用select。</p><p><strong>全局变量：(1)以@@作为前缀(2)由系统进行定义和维护，只读</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- @@ERROR:返回执行的上一个语句的错误号</span></span><br><span class="line"><span class="comment">-- @@IDENTITY:返回最后插入的标积值</span></span><br><span class="line"><span class="comment">-- @@MAX_CONNECTIONS:返回允许同时进行的最大用户连接数</span></span><br><span class="line"><span class="comment">-- @@ROWCOUNT:返回受上一语句影响的行数</span></span><br><span class="line"><span class="comment">-- @@SERVERNAME:返回运行SQL Server的本地服务器的名称</span></span><br><span class="line"><span class="comment">-- @@SERVICENAME:返回SQL Server正在其下运行的注册表项的名称</span></span><br><span class="line"><span class="comment">-- @@TRANCOUNT:返回当前连接的活动事务数</span></span><br><span class="line"><span class="comment">-- @@LOCK_TIMEOUT:返回当前会话的当前锁定超时设置（毫秒）</span></span><br></pre></td></tr></table></figure><p>变量示例：<br>(1)为赵云此人进行开户开卡操作，赵云身份证：420107199904054233</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@AccountId</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> AccountInfo(AccountCode,AccountPhone,RealName,OpenTime)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;420107199904054233&#x27;</span>,<span class="string">&#x27;15878547898&#x27;</span>,<span class="string">&#x27;赵云&#x27;</span>，GETDATE())</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@AccountId</span> <span class="operator">=</span>  @<span class="variable">@identity</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> BankCard(CardNo,AccountId,CardPwd,CardMoney,Cardstate)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;6225123412357896&#x27;</span>,<span class="variable">@AccountId</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>(2)需要求出张飞的银行卡卡号和余额，张飞身份证：420107199602034138</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方法1</span></span><br><span class="line"><span class="keyword">select</span>  CardNo 银行卡卡号,CardMoney 银行卡余额 <span class="keyword">from</span>BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> AccountInfo <span class="keyword">on</span> BankCard.AccountId<span class="operator">=</span>AccountInfo.AccountId</span><br><span class="line"><span class="keyword">where</span>AccountCode<span class="operator">=</span><span class="string">&#x27;420107199602034138&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方法2</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@CardNo</span> <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">select</span><span class="variable">@CardNo</span> <span class="operator">=</span> CardNO</span><br><span class="line"><span class="keyword">from</span>BankCard</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> AccountInfo <span class="keyword">on</span> BankCard.AccountId<span class="operator">=</span>AccountInfo.AccountId</span><br><span class="line"><span class="keyword">where</span>AccountCode<span class="operator">=</span><span class="string">&#x27;420107199602034138&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> CardNo 银行卡卡号,CardMoney 银行卡余额 <span class="keyword">from</span> BankCard <span class="keyword">where</span> CardNo <span class="operator">=</span> <span class="variable">@CardNo</span></span><br><span class="line">print <span class="variable">@CardNo</span></span><br></pre></td></tr></table></figure><h2 id="3-go"><a href="#3-go" class="headerlink" title="3. go"></a>3. go</h2><blockquote><p>  (1)等待go语句之前的代码执行完成后才能执行后面的代码</p><p>  (2) 批处理结束的一个标识</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database DBTEST1</span><br><span class="line">go</span><br><span class="line">use DBTEST1</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> AccountInfo ( <span class="comment">--账户信息表</span></span><br><span class="line">AccountId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),<span class="comment">--账户编号</span></span><br><span class="line">AccountCode <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--身份证号码</span></span><br><span class="line">AccountPhone <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--电话号码</span></span><br><span class="line">RealName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--真实姓名</span></span><br><span class="line">OpenTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--开户时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@num</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@num</span> <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@num</span> <span class="operator">=</span> <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@num</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@num</span> <span class="operator">=</span> <span class="number">100</span></span><br><span class="line">go</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@num</span> <span class="operator">=</span> <span class="number">200</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>11. 实例数据库</title>
    <link href="http://example.com/2022/12/03/SqlServer/11.%E5%AE%9E%E4%BE%8B%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>http://example.com/2022/12/03/SqlServer/11.%E5%AE%9E%E4%BE%8B%E6%95%B0%E6%8D%AE%E5%BA%93/</id>
    <published>2022-12-03T07:53:10.390Z</published>
    <updated>2022-12-06T12:23:45.684Z</updated>
    
    <content type="html"><![CDATA[<h1 id="实例数据库"><a href="#实例数据库" class="headerlink" title="实例数据库"></a>实例数据库</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--表结构设计</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> AccountInfo ( <span class="comment">--账户信息表</span></span><br><span class="line">AccountId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),<span class="comment">--账户编号</span></span><br><span class="line">AccountCode <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--身份证号码</span></span><br><span class="line">AccountPhone <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--电话号码</span></span><br><span class="line">RealName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--真实姓名</span></span><br><span class="line">OpenTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--开户时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> BankCard ( <span class="comment">--银行卡</span></span><br><span class="line">CardNo <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">primary</span> key,<span class="comment">--银行卡卡号</span></span><br><span class="line">AccountId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--账户编号（与账户信息表形成主外键关系）</span></span><br><span class="line">CardPwd <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡密码</span></span><br><span class="line">CardMoney money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡余额</span></span><br><span class="line">CardState <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--1:正常，2挂失，3：冻结，4：注销</span></span><br><span class="line">CardTime smalldatetime <span class="keyword">default</span> (getdate())<span class="comment">--开卡时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> CardExchange ( <span class="comment">--交易信息表（存储存钱和取钱的记录</span></span><br><span class="line">Exchangeld <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),<span class="comment">--交易自动编号</span></span><br><span class="line">CardNo <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡号（与银行卡表形成主外键关系）</span></span><br><span class="line">MoneyInBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--存钱金额</span></span><br><span class="line">MoneyOutBank money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--取钱金额</span></span><br><span class="line">ExchangeTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--交易时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> CardTransfer ( <span class="comment">--转账信息表（存储转账信息记录）</span></span><br><span class="line">TransferId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),<span class="comment">--转账自动编号</span></span><br><span class="line">CardNoOut <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--转出银行卡号（与银行卡表形成主外键关系）</span></span><br><span class="line">CardNoIn <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--转入银行卡号（与银行卡表形成主外键关系）</span></span><br><span class="line">TransferMoney money <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--交易金额</span></span><br><span class="line">TransferTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span>, <span class="comment">--交易时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> CardStateChange ( <span class="comment">--状态信息变化表（存储银行卡状态l:正常，2：挂失，3：冻结，4：注销</span></span><br><span class="line">Stateld <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="comment">--状态信息自动编号</span></span><br><span class="line">CardNo <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡号（与银行卡表形成主外键关系)</span></span><br><span class="line">OldState <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡原始状态</span></span><br><span class="line">NewState <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--银行卡新状态</span></span><br><span class="line">StateWhy <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">not</span> <span class="keyword">null</span>,<span class="comment">--状态变化原因</span></span><br><span class="line">StateTime smalldatetime <span class="keyword">not</span> <span class="keyword">null</span><span class="comment">--记录产生时间</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--为刘备，关羽，张飞三个人进行开户开卡的操作</span></span><br><span class="line"><span class="comment">--刘备身份证：420107198905064135</span></span><br><span class="line"><span class="comment">--关羽身份证：420107199507104133</span></span><br><span class="line"><span class="comment">--张飞身份证：420107199602034138</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> AccountInfo (AccountCode, AccountPhone, RealName, OpenTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;420107198905064135&#x27;</span>, <span class="string">&#x27;13554785425&#x27;</span>, <span class="string">&#x27;刘备&#x27;</span>, getdate());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225125478544587&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> AccountInfo (AccountCode, AccountPhone, RealName, OpenTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;420107199507104133&#x27;</span>, <span class="string">&#x27;13454788854&#x27;</span>, <span class="string">&#x27;关羽&#x27;</span>, getdate());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741263&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> AccountInfo (AccountCode, AccountPhone, RealName, OpenTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;420107199602034138&#x27;</span>, <span class="string">&#x27;13456896321&#x27;</span>, <span class="string">&#x27;张飞&#x27;</span>, getdate());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> BankCard (CardNo, AccountId, CardPwd, CardMoney, CardState)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547854125656&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.AccountInfo;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.BankCard;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--进行存钱操作，刘备存钱2000元，关羽存钱：8000元，张飞存钱：500000元</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> AccountInfo;</span><br><span class="line"><span class="keyword">update</span>BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="operator">+</span><span class="number">2000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225125478544587&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225125478544587&#x27;</span>, <span class="number">2000</span>, <span class="number">0</span>, getdate());</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span>BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="operator">+</span><span class="number">8000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547858741263&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547858741263&#x27;</span>, <span class="number">8000</span>, <span class="number">0</span>, getdate());</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span>BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="operator">+</span><span class="number">500000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547854125656&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> CardExchange (CardNo, MoneyInBank, MoneyOutBank, ExchangeTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225547854125656&#x27;</span>, <span class="number">500000</span>, <span class="number">0</span>, getdate());</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> dbo.CardExchange;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--转账：刘备给张飞转账1000元</span></span><br><span class="line"><span class="keyword">update</span>BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="number">-1000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225125478544587&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span>BankCard</span><br><span class="line"><span class="keyword">set</span>CardMoney<span class="operator">=</span>CardMoney<span class="operator">+</span><span class="number">1000</span></span><br><span class="line"><span class="keyword">where</span>CardNo<span class="operator">=</span><span class="string">&#x27;6225547854125656&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> CardTransfer (CardNoOut, CardNoIn, TransferMoney, TransferTime)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;6225125478544587&#x27;</span>, <span class="string">&#x27;6225547854125656&#x27;</span>, <span class="number">1000</span>, getdate());</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.CardTransfer</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>10. 数据库设计</title>
    <link href="http://example.com/2022/12/03/SqlServer/10.%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/"/>
    <id>http://example.com/2022/12/03/SqlServer/10.%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-12-03T05:44:00.038Z</published>
    <updated>2022-12-05T09:29:03.972Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><h2 id="1-数据库结构设计三范式"><a href="#1-数据库结构设计三范式" class="headerlink" title="1. 数据库结构设计三范式"></a>1. 数据库结构设计三范式</h2><p><strong>第一范式：是对属性的原子性，要求属性具有原子性，不可再分解</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student </span><br><span class="line">(</span><br><span class="line">StuId <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">StuContact <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Student(StuId,StuName,StuContact)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;001&#x27;</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="string">&#x27;QQ:185903453;Tel:13888888888&#x27;</span>);</span><br></pre></td></tr></table></figure><p>上述设计则不满足第一范式，联系方式这一列并不是不可再分的最小单元，应修改为如下结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student </span><br><span class="line">(</span><br><span class="line">StuId <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">Tel <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">QQ <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>第二范式：是对记录的唯一性，要求记录有唯一表示，即实体的唯一性，即不存在部分依赖</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> StudentCourse (StuId <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">CourseId <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">CourseName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">CourseScore <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.StudentCourse(StuId, StuName, CourseId, CourseName, CourseScore)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;001&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;刘备&#x27;</span>, <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;001&#x27;</span>, <span class="comment">-- CourseId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;语文&#x27;</span>, <span class="comment">-- CourseName - varchar(20)</span></span><br><span class="line"><span class="number">80</span>  <span class="comment">-- CourseScore - int</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.StudentCourse(StuId, StuName, CourseId, CourseName, CourseScore)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;001&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;刘备&#x27;</span>, <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;002&#x27;</span>, <span class="comment">-- CourseId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;数学&#x27;</span>, <span class="comment">-- CourseName - varchar(20)</span></span><br><span class="line"><span class="number">70</span>  <span class="comment">-- CourseScore - int</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.StudentCourse(StuId, StuName, CourseId, CourseName, CourseScore)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;002&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>, <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;003&#x27;</span>, <span class="comment">-- CourseId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;英语&#x27;</span>, <span class="comment">-- CourseName - varchar(20)</span></span><br><span class="line"><span class="number">80</span>  <span class="comment">-- CourseScore - int</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.StudentCourse(StuId, StuName, CourseId, CourseName, CourseScore)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;003&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;张飞&#x27;</span>, <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;003&#x27;</span>, <span class="comment">-- CourseId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;英语&#x27;</span>, <span class="comment">-- CourseName - varchar(20)</span></span><br><span class="line"><span class="number">90</span>  <span class="comment">-- CourseScore - int</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure><p>上述设计中有两个事物，一个学生信息，一个课程信息，很显然这两个事务都没有保证实体唯一性，这里的姓名依赖学号，课程名称依赖课程编号，所以不符合二范式，会造成数据的冗余</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Course <span class="comment">-- 课程</span></span><br><span class="line">(CourseId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="comment">-- 课程编号</span></span><br><span class="line">CourseName <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">CourseContent text <span class="comment">-- 课程介绍</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Course(CourseName, CourseContent)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;HTML&#x27;</span>, <span class="comment">-- CourseName - varchar(30)</span></span><br><span class="line"><span class="string">&#x27;静态网页制作&#x27;</span> <span class="comment">-- CourseContent - text</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Course(CourseName, CourseContent)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;WinForm&#x27;</span>, <span class="comment">-- CourseName - varchar(30)</span></span><br><span class="line"><span class="string">&#x27;Windows应用程序开发&#x27;</span> <span class="comment">-- CourseContent - text</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student (StuId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="comment">-- 学生编号</span></span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">StuSex <span class="type">char</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student(StuName, StuSex)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;刘备&#x27;</span>, <span class="comment">-- StuName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span> <span class="comment">-- StuSex - char(2)</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student(StuName, StuSex)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;张飞&#x27;</span>, <span class="comment">-- StuName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;男&#x27;</span> <span class="comment">-- StuSex - char(2)</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Exam (ExamId <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY <span class="keyword">IDENTITY</span>(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">                   StuId <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">                   CourseId <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">                   Score <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dbo.Exam (StuId,</span><br><span class="line">                      CourseId,</span><br><span class="line">                      Score)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="comment">-- StuId - int</span></span><br><span class="line">        <span class="number">1</span>, <span class="comment">-- CourseId - int</span></span><br><span class="line">        <span class="number">90</span> <span class="comment">-- Score - int</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dbo.Exam (StuId,</span><br><span class="line">                      CourseId,</span><br><span class="line">                      Score)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="comment">-- StuId - int</span></span><br><span class="line">        <span class="number">2</span>, <span class="comment">-- CourseId - int</span></span><br><span class="line">        <span class="number">80</span> <span class="comment">-- Score - int</span></span><br><span class="line">    );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dbo.Exam (StuId,</span><br><span class="line">                      CourseId,</span><br><span class="line">                      Score)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="comment">-- StuId - int</span></span><br><span class="line">        <span class="number">2</span>, <span class="comment">-- CourseId - int</span></span><br><span class="line">        <span class="number">85</span> <span class="comment">-- Score - int</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure><p><strong>第三范式：要求任何字段不能由其他字段派生出来，它要求字段没有冗余，即不存在依赖。如有如下表结构设计：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student</span><br><span class="line">(</span><br><span class="line">StuId <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">ProfessionalId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">ProfessionalName <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">ProfessionalRemark <span class="type">varchar</span>(<span class="number">200</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student (StuId, StuName, ProfessionalId, ProfessionalName, ProfessionalRemark)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;刘备&#x27;</span>,<span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- ProfessionalId - int</span></span><br><span class="line"><span class="string">&#x27;计算机&#x27;</span>,<span class="comment">-- ProfessionalName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;最牛的专业&#x27;</span><span class="comment">-- ProfessionalRemark - varchar(200)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student (StuId, StuName, ProfessionalId, ProfessionalName, ProfessionalRemark)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;002&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>,<span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="number">2</span>,<span class="comment">-- ProfessionalId - int</span></span><br><span class="line"><span class="string">&#x27;工商管理&#x27;</span>,<span class="comment">-- ProfessionalName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;管理学的基础专业&#x27;</span><span class="comment">-- ProfessionalRemark - varchar(200)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student (StuId, StuName, ProfessionalId, ProfessionalName, ProfessionalRemark)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;003&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;张飞&#x27;</span>,<span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="number">1</span>,<span class="comment">-- ProfessionalId - int</span></span><br><span class="line"><span class="string">&#x27;计算机&#x27;</span>,<span class="comment">-- ProfessionalName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;最牛的专业&#x27;</span><span class="comment">-- ProfessionalRemark - varchar(200)</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述设计中专业名称和字段和专业介绍字段，再数据库中会产生很多冗余数据，不满足第二范式，优化方案如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Professional (ProfessionalId <span class="type">int</span> <span class="keyword">primary</span> key <span class="keyword">identity</span>(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">ProfessionalName <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">ProfessionalRemark <span class="type">varchar</span>(<span class="number">200</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Student (StuId <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">primary</span> key,</span><br><span class="line">StuName <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">ProfessionalId <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Professional (ProfessionalName, ProfessionalRemark)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;计算机&#x27;</span>, <span class="comment">-- ProfessionalName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;最牛的专业&#x27;</span>   <span class="comment">-- ProfessionalRemark - varchar(200)</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Professional (ProfessionalName, ProfessionalRemark)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;工商管理&#x27;</span>, <span class="comment">-- ProfessionalName - varchar(50)</span></span><br><span class="line"><span class="string">&#x27;管理学的基础专业&#x27;</span><span class="comment">-- ProfessionalRemark - varchar(200)</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student (StuId, StuName, ProfessionalId)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;刘备&#x27;</span>,   <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="number">1</span>   <span class="comment">-- ProfessionalId - int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dbo.Student (StuId, StuName, ProfessionalId)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;002&#x27;</span>, <span class="comment">-- StuId - varchar(20)</span></span><br><span class="line"><span class="string">&#x27;关羽&#x27;</span>,   <span class="comment">-- StuName - varchar(20)</span></span><br><span class="line"><span class="number">2</span>   <span class="comment">-- ProfessionalId - int</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>9. 多表查询</title>
    <link href="http://example.com/2022/12/01/SqlServer/9.%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/12/01/SqlServer/9.%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-12-01T14:22:08.764Z</published>
    <updated>2022-12-05T09:29:21.081Z</updated>
    
    <content type="html"><![CDATA[<h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Department;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 笛卡尔积</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Department, People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简单多表查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People, dbo.Department</span><br><span class="line"><span class="keyword">where</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息显示职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.[Rank];</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.People;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.[Rank], dbo.People</span><br><span class="line"><span class="keyword">where</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称和职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.[Rank], dbo.People,dbo.Department</span><br><span class="line"><span class="keyword">where</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId <span class="keyword">and</span></span><br><span class="line">dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 内连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People</span><br><span class="line">     <span class="keyword">inner</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息显示职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People <span class="keyword">inner</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称和职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简单多表查询和内连接共同的特点</span></span><br><span class="line"><span class="comment">-- 不符合主外键关系的数据不会被显示出来</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 外连接（ 左外连，右外连，全外联）</span></span><br><span class="line"><span class="comment">-- 左外联：以左表为主表进行数据显示，主外键关系找不到的数据null取代</span></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.Department</span><br><span class="line">     <span class="keyword">left</span> <span class="keyword">join</span> dbo.People <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息显示职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People <span class="keyword">left</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称和职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 右外联：以右表为主表进行数据显示，主外键关系找不到的数据null取代</span></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.Department</span><br><span class="line">     <span class="keyword">right</span> <span class="keyword">join</span> dbo.People <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息显示职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People <span class="keyword">right</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称和职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People </span><br><span class="line"><span class="keyword">right</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId</span><br><span class="line"><span class="keyword">right</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 全外连：两张表的数据，无论是否符合关系，都要显示</span></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.Department</span><br><span class="line">     <span class="keyword">full</span> <span class="keyword">join</span> dbo.People <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息显示职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People <span class="keyword">full</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工信息，显示部门名称和职级名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> dbo.People </span><br><span class="line"><span class="keyword">full</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> dbo.People.DepartmentId<span class="operator">=</span>Department.DepartmentId</span><br><span class="line"><span class="keyword">full</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出武汉地区所有的员工信息，要求显示部门名称已经员工的详细资料（显示中文别名）</span></span><br><span class="line"><span class="keyword">select</span> PeopleId 员工编号,</span><br><span class="line">DepartmentName 部门名称,</span><br><span class="line">PeopleName 员工姓名,</span><br><span class="line">PeopleSex 员工性别,</span><br><span class="line">PeopleBirth 生日,</span><br><span class="line">PeopleSalary 月薪,</span><br><span class="line">PeoplePhone 电话,</span><br><span class="line">PeopleAddress 地址</span><br><span class="line"><span class="keyword">from</span> dbo.People</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> People.DepartmentId <span class="operator">=</span> Department.DepartmentId <span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;武汉&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出武汉地区的所有员工信息，要求显示部门名称，职级名称以及员工的详细资料</span></span><br><span class="line"><span class="keyword">select</span> PeopleId 员工编号,</span><br><span class="line">DepartmentName 部门名称,</span><br><span class="line">RankName 职级名称,</span><br><span class="line">PeopleName 员工姓名,</span><br><span class="line">PeopleSex 员工性别,</span><br><span class="line">PeopleBirth 生日,</span><br><span class="line">PeopleSalary 月薪,</span><br><span class="line">PeoplePhone 电话,</span><br><span class="line">PeopleAddress 地址</span><br><span class="line"><span class="keyword">from</span> dbo.People</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> People.DepartmentId <span class="operator">=</span> Department.DepartmentId </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.[Rank] <span class="keyword">on</span> dbo.People.RankId<span class="operator">=</span>dbo.[Rank].RankId</span><br><span class="line"><span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;武汉&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据部门分组统计员工人数，员工工资总和，平均工资，最高工资，最低工资</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">DepartmentName 部门名称,</span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) 员工人数,</span><br><span class="line"><span class="built_in">sum</span>(PeopleSalary) 员工工资总和,</span><br><span class="line"><span class="built_in">avg</span>(PeopleSalary) 平均工资,</span><br><span class="line"><span class="built_in">max</span>(PeopleSalary) 最高工资,</span><br><span class="line"><span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> People.DepartmentId <span class="operator">=</span> Department.DepartmentId </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> People.DepartmentId,DepartmentName;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据部门分组统计员工人数，员工工资总和，平均工资，最高工资，最低工资</span></span><br><span class="line"><span class="comment">-- 平均工资在10000以下的不参与统计，并且根据工资降序排列</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">DepartmentName 部门名称,</span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) 员工人数,</span><br><span class="line"><span class="built_in">sum</span>(PeopleSalary) 员工工资总和,</span><br><span class="line"><span class="built_in">avg</span>(PeopleSalary) 平均工资,</span><br><span class="line"><span class="built_in">max</span>(PeopleSalary) 最高工资,</span><br><span class="line"><span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> People.DepartmentId <span class="operator">=</span> Department.DepartmentId </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> People.DepartmentId,DepartmentName</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(PeopleSalary) <span class="operator">&gt;=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">avg</span>(PeopleSalary) <span class="keyword">desc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据部门名称，然后根据职称名称</span></span><br><span class="line"><span class="comment">-- 分组统计员工人数，员工工资总和，平均工资，最高工资，最低工资</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">DepartmentName 部门名称,</span><br><span class="line">RankName 职级名称,</span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) 员工人数,</span><br><span class="line"><span class="built_in">sum</span>(PeopleSalary) 员工工资总和,</span><br><span class="line"><span class="built_in">avg</span>(PeopleSalary) 平均工资,</span><br><span class="line"><span class="built_in">max</span>(PeopleSalary) 最高工资,</span><br><span class="line"><span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> dbo.Department <span class="keyword">on</span> People.DepartmentId<span class="operator">=</span>Department.DepartmentId</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> [dbo].[Rank] <span class="keyword">on</span> People.RankId <span class="operator">=</span> dbo.[Rank].RankId</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Department.DepartmentId,Department.DepartmentName,dbo.[Rank].RankId,dbo.[Rank].RankName</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自连接(自己与自己连接)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> Dept </span><br><span class="line">(</span><br><span class="line">DeptId <span class="type">int</span> <span class="keyword">primary</span> key, <span class="comment">-- 部门编号</span></span><br><span class="line">DeptName <span class="type">varchar</span>(<span class="number">50</span>), <span class="comment">-- 部门名称</span></span><br><span class="line">ParentId <span class="type">int</span>,<span class="comment">-- 上级部门编号</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;软件部&#x27;</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;硬件部&#x27;</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;软件研发部&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;软件测试部&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;软件实施部&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;硬件研发部&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;硬件测试部&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Dept(DeptId,DeptName,ParentId)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">8</span>,<span class="string">&#x27;硬件实施部&#x27;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dbo.Dept</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> A.DeptId 部门编号, A.DeptName 部门名称, B.DeptName 上级部门 <span class="keyword">from</span> dbo.Dept A</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Dept B</span><br><span class="line"><span class="keyword">on</span> A.ParentId <span class="operator">=</span> B.DeptId</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>8. 分组查询</title>
    <link href="http://example.com/2022/12/01/SqlServer/8.%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/12/01/SqlServer/8.%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-12-01T08:07:09.648Z</published>
    <updated>2022-12-05T09:29:34.334Z</updated>
    
    <content type="html"><![CDATA[<h1 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h1><blockquote><p>  group by 字段名 having 特殊条件</p><p>  select 字段 from 表名 where 条件 group by 分组 having 聚合函数的条件</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 统计员工人数，员工工资总和，平均工资，最高工资和最低工资</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据员工地区分组统计员工人数......</span></span><br><span class="line"><span class="comment">-- 方案1：union 连接</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;武汉&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方案2：group by 分组</span></span><br><span class="line"><span class="keyword">select</span> PeopleAddress     地址</span><br><span class="line">     , <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> PeopleAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据员工地区分组统计员工人数...... （1985年后的不统计)</span></span><br><span class="line"><span class="keyword">select</span> PeopleAddress     地址</span><br><span class="line">     , <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleBirth <span class="operator">&lt;</span> <span class="string">&#x27;1985-01-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> PeopleAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据员工地区分组统计员工人数...... （1985年后的不统,员工人数必须在两人以上)</span></span><br><span class="line"><span class="keyword">select</span> PeopleAddress     地址</span><br><span class="line">     , <span class="built_in">count</span>(<span class="operator">*</span>)          员工人数</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary) 工资总和</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary) 平均工资</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary) 最高工资</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary) 最低工资</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleBirth <span class="operator">&lt;</span> <span class="string">&#x27;1985-01-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> PeopleAddress</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>7.聚合函数</title>
    <link href="http://example.com/2022/12/01/SqlServer/7.%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/"/>
    <id>http://example.com/2022/12/01/SqlServer/7.%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/</id>
    <published>2022-12-01T05:33:22.502Z</published>
    <updated>2022-12-05T09:29:58.408Z</updated>
    
    <content type="html"><![CDATA[<h1 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h1><blockquote><p>  sql server 中常用的聚合函数主要有：</p></blockquote><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>count</td><td>求数量</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>min</td><td>最小值</td></tr><tr><td>sum</td><td>求和</td></tr><tr><td>avg</td><td>平均值</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求员工总人数</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) 总人数</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求最高工资</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求最小工资</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求所有员工工资之和</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求员工平均工资</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求数量最大值最小值总和平均值，在一行显示</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出武汉地区的员工人数、总工资、最高工资、最低工资和平均工资</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     , <span class="built_in">max</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">min</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">sum</span>(PeopleSalary)</span><br><span class="line">     , <span class="built_in">avg</span>(PeopleSalary)</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;武汉&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求出工资比平均工资高的人员信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleSalary <span class="operator">&gt;</span> <span class="built_in">avg</span>(PeopleSalary);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求数量最大值最小值总和平均值，在一行显示</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     , <span class="built_in">max</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">min</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">sum</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">avg</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line"><span class="keyword">from</span> People;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算出月薪在10000以上的男性员工的最大年龄，最小年龄和平均年龄</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     , <span class="built_in">max</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">min</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">sum</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">avg</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleSex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line">      <span class="keyword">and</span> PeopleSalary <span class="operator">&gt;</span> <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计出所在地在武汉或者上海的所有女员工数量最大年龄最小年龄和平均年龄</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">     , <span class="built_in">max</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">min</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">sum</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line">     , <span class="built_in">avg</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))</span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> PeopleAddress <span class="keyword">in</span> ( <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;上海&#x27;</span> )</span><br><span class="line">      <span class="keyword">and</span> PeopleSex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 求出年龄比平均年龄高的人员信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> People</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth) <span class="operator">&gt;</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">avg</span>(<span class="keyword">year</span>(getdate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth))<span class="keyword">from</span> People</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>6.模糊查询</title>
    <link href="http://example.com/2022/12/01/SqlServer/6.%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/12/01/SqlServer/6.%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-12-01T05:12:16.604Z</published>
    <updated>2022-12-05T09:30:14.863Z</updated>
    
    <content type="html"><![CDATA[<h1 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h1><blockquote><p>  模糊查询使用like关键字和通配符结合来实现，通配符具体含义如下</p></blockquote><table><thead><tr><th>通配符</th><th>含义</th></tr></thead><tbody><tr><td>%</td><td>代表匹配0个字符、1个字符或者多个字符</td></tr><tr><td>_</td><td>代表匹配有且只有一个字符</td></tr><tr><td>[]</td><td>代表匹配范围内</td></tr><tr><td>[^]</td><td>代表匹配不在范围内</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [Rank]</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出姓刘的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="keyword">like</span> <span class="string">&#x27;刘%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出名字中含有 &#x27;尚&#x27; 的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="keyword">like</span> <span class="string">&#x27;%尚%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出名字中含有 &#x27;尚&#x27; 或者 &#x27;飞&#x27; 的员工信息 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="keyword">like</span> <span class="string">&#x27;%尚%&#x27;</span> <span class="keyword">or</span>  PeopleName <span class="keyword">like</span> <span class="string">&#x27;%飞%&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出姓刘的员工信息，名字是两个字</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="keyword">like</span> <span class="string">&#x27;刘_&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出姓刘的员工信息，名字是两个字</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> <span class="built_in">substring</span>(PeopleName,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;刘&#x27;</span> <span class="keyword">and</span> len(PeopleName) <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询名字最后一个字为香，名字是三个字</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="keyword">like</span> <span class="string">&#x27;__香&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> <span class="built_in">substring</span>(PeopleName,<span class="number">3</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;香&#x27;</span> <span class="keyword">and</span> len(PeopleName) <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出电话号码开头为138的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeoplePhone <span class="keyword">like</span> <span class="string">&#x27;138%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出电话号码开头为138，第四位好像是7或者8，最后一个号码是5</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeoplePhone <span class="keyword">like</span> <span class="string">&#x27;138[7,8]%8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出电话号码开头为138，第四位好像是2-5，最后一个号码不是2和3</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeoplePhone <span class="keyword">like</span> <span class="string">&#x27;138[2-5]%[^2,3]&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>5.条件查询</title>
    <link href="http://example.com/2022/11/30/SqlServer/5.%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/11/30/SqlServer/5.%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-11-30T13:48:21.884Z</published>
    <updated>2022-12-05T09:30:28.728Z</updated>
    
    <content type="html"><![CDATA[<h1 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h1><h2 id="1-SQL中常用运算符"><a href="#1-SQL中常用运算符" class="headerlink" title="1. SQL中常用运算符"></a>1. SQL中常用运算符</h2><table><thead><tr><th>运算符</th><th>描述</th></tr></thead><tbody><tr><td>&#x3D;</td><td>比较是否相等或者是赋值</td></tr><tr><td>!&#x3D;</td><td>不等于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;&#x3D;</td><td>大于等于</td></tr><tr><td>&lt;&#x3D;</td><td>小于等于</td></tr><tr><td>is null</td><td>比较为空</td></tr><tr><td>is not null</td><td>比较不为空</td></tr><tr><td>in</td><td>比较是否再其中</td></tr><tr><td>like</td><td>模糊查询</td></tr><tr><td>between…and…</td><td>比较是否在两者之间</td></tr><tr><td>and</td><td>逻辑与</td></tr><tr><td>or</td><td>逻辑或</td></tr><tr><td>not</td><td>逻辑非</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询性别为女的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资大于等于10000元的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="operator">&gt;=</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出性别为女，工资大于等于10000元的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">and</span> PeopleSex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询月薪大于等于10000的员工，或者月薪大于等于8000的女员工</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">or</span> (PeopleSalary <span class="operator">&gt;=</span> <span class="number">8000</span> <span class="keyword">and</span> PeopleSex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出生年月在1980-1-1之后，而且月薪大于等于10000</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleBirth <span class="operator">&gt;=</span> <span class="string">&#x27;1980-01-01&#x27;</span> <span class="keyword">and</span> PeopleSalary <span class="operator">&gt;</span><span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询月薪在8000-12000之间的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="keyword">between</span> <span class="number">8000</span> <span class="keyword">and</span> <span class="number">12000</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="operator">&gt;=</span> <span class="number">8000</span> <span class="keyword">and</span> PeopleSalary <span class="operator">&lt;=</span> <span class="number">12000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出地址在武汉或者北京的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> <span class="keyword">or</span> PeopleAddress <span class="operator">=</span> <span class="string">&#x27;武汉&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleAddress <span class="keyword">in</span> (<span class="string">&#x27;武汉&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排序</span></span><br><span class="line"><span class="comment">-- 查询所有员工信息 根据工资降序</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">order</span> <span class="keyword">by</span> PeopleSalary <span class="keyword">desc</span></span><br><span class="line"><span class="comment">-- 查询所有员工信息 根据工资升序</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">order</span> <span class="keyword">by</span> PeopleSalary <span class="keyword">asc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有员工信息，根据名字长度排序（降序）</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">order</span> <span class="keyword">by</span> len(PeopleName) <span class="keyword">desc</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出工资最高的5个人的信息</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">5</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">order</span> <span class="keyword">by</span> PeopleSalary <span class="keyword">desc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出工资最高的10%的员工信息</span></span><br><span class="line"><span class="keyword">select</span> top <span class="number">10</span> <span class="keyword">percent</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">order</span> <span class="keyword">by</span> PeopleSalary <span class="keyword">desc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- null:空值</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> People(DepartmentId,RankId,PeopleName,PeopleSex,PeopleBirth,</span><br><span class="line">PeopleSalary,PeoplePhone,PeopleAddress,PeopleAddTime)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;马云&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1977-01-01&#x27;</span>,<span class="number">1000000</span>,<span class="string">&#x27;15670561755&#x27;</span>,<span class="keyword">null</span>,getdate())</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出地址没有填写的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleAddress <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="comment">-- 查询出地址已经填写的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleAddress <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出80后的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleBirth <span class="operator">&gt;=</span> <span class="string">&#x27;1980-01-01&#x27;</span> <span class="keyword">and</span> PeopleBirth <span class="operator">&lt;=</span><span class="string">&#x27;1990-01-01&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleBirth <span class="keyword">between</span> <span class="string">&#x27;1980-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;1990-01-01&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span>  <span class="keyword">year</span>(PeopleBirth) <span class="keyword">between</span> <span class="number">1980</span> <span class="keyword">and</span> <span class="number">1990</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询30-40岁之间，并且工资在15000-30000之间的员工信息</span></span><br><span class="line"><span class="comment">-- 假设 年龄 = 当前年份 - 生日年份</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People </span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">year</span>(getDate()) <span class="operator">-</span> <span class="keyword">year</span>(PeopleBirth) <span class="keyword">between</span> <span class="number">30</span> <span class="keyword">and</span> <span class="number">40</span> ) <span class="keyword">and</span> </span><br><span class="line">(PeopleSalary <span class="keyword">between</span> <span class="number">15000</span> <span class="keyword">and</span> <span class="number">30000</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出星座是巨蟹座的员工信息（6.22-7.22）</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span></span><br><span class="line">(<span class="keyword">month</span>(PeopleBirth) <span class="operator">=</span><span class="number">6</span> <span class="keyword">and</span> <span class="keyword">day</span>(PeopleBirth) <span class="operator">&gt;=</span> <span class="number">22</span>)</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">(<span class="keyword">month</span>(PeopleBirth) <span class="operator">=</span><span class="number">7</span> <span class="keyword">and</span> <span class="keyword">day</span>(PeopleBirth) <span class="operator">&lt;=</span> <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出工资比赵云高的人的信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleSalary <span class="operator">&gt;</span> (<span class="keyword">select</span> PeopleSalary <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="operator">=</span> <span class="string">&#x27;赵云&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出和赵云在一个城市的人的信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> PeopleAddress <span class="operator">=</span> (<span class="keyword">select</span> PeopleAddress <span class="keyword">from</span> People <span class="keyword">where</span> PeopleName <span class="operator">=</span> <span class="string">&#x27;赵云&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出生肖是鼠的人的信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People <span class="keyword">where</span> <span class="keyword">year</span>(PeopleBirth) <span class="operator">%</span> <span class="number">12</span> <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有员工信息，添加一列，显示生肖</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">year</span>(PeopleBirth) <span class="operator">%</span> <span class="number">12</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;鼠&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">5</span> <span class="keyword">then</span> <span class="string">&#x27;牛&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">6</span> <span class="keyword">then</span> <span class="string">&#x27;虎&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">7</span> <span class="keyword">then</span> <span class="string">&#x27;兔&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">8</span> <span class="keyword">then</span> <span class="string">&#x27;龙&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">9</span> <span class="keyword">then</span> <span class="string">&#x27;蛇&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">10</span> <span class="keyword">then</span> <span class="string">&#x27;马&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">11</span> <span class="keyword">then</span> <span class="string">&#x27;羊&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">0</span> <span class="keyword">then</span> <span class="string">&#x27;猴&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;鸡&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;狗&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;猪&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">end</span> 生肖</span><br><span class="line"><span class="keyword">from</span> People </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>4.基础查询</title>
    <link href="http://example.com/2022/11/30/SqlServer/4.%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2/"/>
    <id>http://example.com/2022/11/30/SqlServer/4.%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2/</id>
    <published>2022-11-30T13:47:10.899Z</published>
    <updated>2022-12-05T09:30:41.131Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有的列所有行</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [Rank]</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询指定列(姓名、性别、生日、月薪、电话)</span></span><br><span class="line"><span class="keyword">select</span> PeopleName,PeopleSex,PeopleBirth,PeopleSalary,PeoplePhone <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询指定列(姓名，性别，生日，月薪，电话)(显示中文列名)</span></span><br><span class="line"><span class="keyword">select</span> PeopleName 姓名,PeopleSex 性别,PeopleBirth 生日,PeopleSalary 月薪,PeoplePhone 电话 <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出员工所在城市(不需要进行重复查询)</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> PeopleAddress <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设准备加工资(工资上调20%)，查询出加工资后的员工数据</span></span><br><span class="line"><span class="keyword">select</span> [PeopleName],[PeopleSex],</span><br><span class="line">[PeopleSalary] <span class="operator">*</span> <span class="number">1.2</span> PeopleSalary加薪后,[PeopleSalary]  PeopleSalary加薪前 </span><br><span class="line"><span class="keyword">from</span> People</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>3.修改和删除数据</title>
    <link href="http://example.com/2022/11/30/SqlServer/3.%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/"/>
    <id>http://example.com/2022/11/30/SqlServer/3.%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/</id>
    <published>2022-11-30T13:04:15.538Z</published>
    <updated>2022-12-05T09:30:53.090Z</updated>
    
    <content type="html"><![CDATA[<h1 id="修改和删除数据"><a href="#修改和删除数据" class="headerlink" title="修改和删除数据"></a>修改和删除数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Department</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> [Rank]</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改数据 语法</span></span><br><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>,字段<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span> <span class="keyword">where</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给某个人加薪1000</span></span><br><span class="line"><span class="keyword">update</span> People <span class="keyword">set</span> PeopleSalary <span class="operator">=</span> PeopleSalary <span class="operator">+</span> <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将员工编号为15的人加薪500</span></span><br><span class="line"><span class="keyword">update</span> People <span class="keyword">set</span> PeopleSalary <span class="operator">=</span> PeopleSalary <span class="operator">+</span> <span class="number">500</span>  </span><br><span class="line"><span class="keyword">where</span> PeopleId <span class="operator">=</span> <span class="string">&#x27;15&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将软件部(部门编号2)人员工资低于15000的调整为15000</span></span><br><span class="line"><span class="keyword">update</span> People <span class="keyword">set</span> PeopleSalary <span class="operator">=</span> <span class="number">15000</span> </span><br><span class="line"><span class="keyword">where</span> DepartmentId <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> PeopleSalary <span class="operator">&lt;</span> <span class="number">15000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改刘备的工资是以前的两倍，并把刘备的地址改为北京</span></span><br><span class="line"><span class="keyword">update</span> People <span class="keyword">set</span> PeopleSalary <span class="operator">=</span> PeopleSalary <span class="operator">*</span> <span class="number">2</span>,PeopleAddress <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span> </span><br><span class="line"><span class="keyword">where</span> PeopleName <span class="operator">=</span> <span class="string">&#x27;刘备&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="comment">-- 语法:</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除员工表所有记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> People</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除部门编号是3的且工资大于10000的人员</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> People <span class="keyword">where</span> DepartmentId <span class="operator">=</span> <span class="number">3</span> <span class="keyword">and</span> PeopleSalary <span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关于删除（drop,truncate,delete)</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> People <span class="comment">-- 删除表对象</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> People <span class="comment">--删除数据（清空数据）</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">table</span> People <span class="comment">--删除所有数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- truncate 和 delete 区别</span></span><br><span class="line"><span class="comment">-- truncate 清空所有数据，不能有条件</span></span><br><span class="line"><span class="comment">-- delete 可以删除所有数据也可以带条件，删除符合条件的数据</span></span><br><span class="line"><span class="comment">-- 自动编号：</span></span><br><span class="line"><span class="comment">-- 假设表中自动编号为1，2，3，4，5</span></span><br><span class="line"><span class="comment">-- 使用truncate清空数据之后再添加数据，编号仍然是1，2，3，4，5</span></span><br><span class="line"><span class="comment">-- 使用delete删除数据后，删除的编号就永远不会有了，后续添加就是6，7，8，9，10</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
  <entry>
    <title>2.插入数据</title>
    <link href="http://example.com/2022/11/30/SqlServer/2.%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/"/>
    <id>http://example.com/2022/11/30/SqlServer/2.%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/</id>
    <published>2022-11-30T11:08:21.961Z</published>
    <updated>2022-12-05T09:31:05.646Z</updated>
    
    <content type="html"><![CDATA[<h1 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 向部门表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department(DepartmentName,DepartmentRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;市场部&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department(DepartmentName,DepartmentRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;软件部&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department(DepartmentName,DepartmentRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;企划部&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简写</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department <span class="keyword">values</span>(<span class="string">&#x27;硬件部&#x27;</span>,<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department <span class="keyword">values</span>(<span class="string">&#x27;总经办&#x27;</span>,<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一次性插入多行数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department(DepartmentName,DepartmentRemark)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;测试部&#x27;</span>,<span class="string">&#x27;......&#x27;</span> <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;实施部&#x27;</span>,<span class="string">&#x27;......&#x27;</span> <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;产品部&#x27;</span>,<span class="string">&#x27;......&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向职级表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [Rank](RankName,RankRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;初级&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [Rank](RankName,RankRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;中级&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [Rank](RankName,RankRemark)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;高级&#x27;</span>,<span class="string">&#x27;......&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向员工表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> People(DepartmentId,RankId,PeopleName,PeopleSex,PeopleBirth,PeopleSalary,PeoplePhone,PeopleAddress,</span><br><span class="line">PeopleAddTime)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">8</span>,<span class="number">1</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;1988-8-8&#x27;</span>,<span class="number">5000</span>,<span class="string">&#x27;13888888888&#x27;</span>,<span class="string">&#x27;中国&#x27;</span>,getDate())</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Sql Server 学习笔记</summary>
    
    
    
    <category term="数据库" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Sql-Server/"/>
    
    
    <category term="数据库" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Sql Server" scheme="http://example.com/tags/Sql-Server/"/>
    
  </entry>
  
</feed>
